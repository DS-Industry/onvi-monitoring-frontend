import{d as B,r as a,bh as J,bi as Q,bj as V,a2 as X,q as Y,t as Z,v as d,b4 as ee,bk as se,bl as ae,j as s,A as te,aA as j,D as oe,G as ne,H as le,b9 as re}from"./index-C24s9YLx.js";import{g as ce}from"./index-Dx68t6LI.js";const me=()=>{const{t}=B(),k=t("warehouse.all"),[r,w]=a.useState(null),[m,i]=a.useState("*"),h=J(),p=Q(),[F,O]=a.useState(!1),{filterOn:P}=V(),v=a.useMemo(()=>[{label:"Номенклатура",key:"nomenclatureName"},{label:"Категория",key:"categoryName"},{label:"Ед. измирения",key:"measurement"},{label:"Итого по всем автомойкам",key:"sum"}],[]),W=X(),o=Y(),g=Z(),{data:f}=d(["get-category"],()=>ee(),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),{data:x}=d(["get-warehouse"],()=>se({posId:W,placementId:o}),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),{data:y}=d(["get-organization"],()=>ce({placementId:o}),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0,onSuccess:e=>{e&&e.length>0&&w(e[0].id)}}),S=(f==null?void 0:f.map(e=>({name:e.props.name,value:e.props.id})))||[],z={name:k,value:"*"};S.unshift(z);const C=(x==null?void 0:x.map(e=>({name:e.props.name,value:e.props.id})))||[],D={name:k,value:"*"};C.unshift(D);const M=(y==null?void 0:y.map(e=>({name:e.name,value:e.id})))||[],{data:N,isLoading:H,mutate:L}=d(r?["get-all-stock-levels",r]:null,()=>ae(r,{warehouseId:u.warehouseId,categoryId:u.categoryId,placementId:u.placementId}),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),c=a.useMemo(()=>N||[],[N]),{columns:T,transformedData:I}=a.useMemo(()=>{if(!c.length)return{columns:v,transformedData:c};const e=[],l=c.map(n=>{const A={...n};return n.inventoryItems.forEach((E,R)=>{const b=`warehouse_${R}`,U=E.warehouseName||`Склад ${R+1}`;e.some(_=>_.key===b)||e.push({label:U,key:b}),A[b]=E.quantity??0}),A});return{columns:[...v,...e],transformedData:l.map(n=>({...n,measurement:n.measurement!==null?t(`tables.${n.measurement}`):""}))}},[c,v,t]),$={categoryId:m,warehouseId:h,placementId:o},[u,q]=a.useState($),G=e=>{q(l=>({...l,...e})),O(!0),e.warehouseId&&p(e.warehouseId),e.categoryId&&i(e.categoryId),e.placementId&&g(e.placementId)};a.useEffect(()=>{G({categoryId:m,warehouseId:h,placementId:o})},[P]),a.useEffect(()=>{L().then(()=>O(!1))},[u,L]);const K=()=>{p("*"),i("*"),g(o)};return s.jsxs(s.Fragment,{children:[s.jsxs(te,{count:I.length,hideDateTime:!0,handleClear:K,address:o,setAddress:g,hideSearch:!0,children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-text02",children:t("warehouse.organization")}),s.jsx(j,{className:"w-full sm:w-80 h-10",options:M.map(e=>({label:e.name,value:e.value})),value:r,onChange:e=>w(e)})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-text02",children:t("warehouse.category")}),s.jsx(j,{className:"w-full sm:w-80 h-10",options:S.map(e=>({label:e.name,value:e.value})),value:m,onChange:e=>i(e)})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-text02",children:t("warehouse.ware")}),s.jsx(j,{className:"w-full sm:w-80 h-10",options:C.map(e=>({label:e.name,value:e.value})),value:h,onChange:e=>p(e)})]})]}),F||H?s.jsx(oe,{columnCount:T.length}):I.length>0?s.jsx("div",{className:"mt-8",children:s.jsx(ne,{data:I.map((e,l)=>({...e,id:l})),columns:T})}):s.jsx(le,{title:t("warehouse.noStock"),description:"",children:s.jsx("img",{src:re,className:"mx-auto",loading:"lazy",alt:"Overhead"})})]})};export{me as default};
