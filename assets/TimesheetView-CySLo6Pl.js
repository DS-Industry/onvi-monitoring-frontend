import{r as n,d as Pe,e as $e,f as qe,v as p,ai as He,cn as Ue,co as ze,cp as Ge,cq as Ze,cr as Ke,y as Qe,z as S,cs as Je,ct as Xe,cu as Ye,j as e,D as N,F as ce,B as h,cv as de,G as b,H as I,aB as oe,aC as me,L as xe,K as E,Q as ue,cw as fe,cx as pe,cy as he,M as ge}from"./index-C24s9YLx.js";import{N as O}from"./NoTimesheet-oebUSuv9.js";const es=t=>n.createElement("svg",{width:40,height:40,viewBox:"0 0 40 40",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},n.createElement("rect",{width:40,height:40,fill:"#F5F5F5"}),n.createElement("g",{clipPath:"url(#clip0_751_38745)"},n.createElement("rect",{width:1440,height:812,transform:"translate(-612 -121)",fill:"white"}),n.createElement("g",{filter:"url(#filter0_d_751_38745)"},n.createElement("rect",{x:-333,y:-27,width:400,height:148,rx:16,fill:"white"})),n.createElement("path",{d:"M-10 20C-10 3.43146 3.43146 -10 20 -10C36.5685 -10 50 3.43146 50 20C50 36.5685 36.5685 50 20 50C3.43146 50 -10 36.5685 -10 20Z",fill:"#DBEAFE"}),n.createElement("path",{d:"M-10 20C-10 3.43146 3.43146 -10 20 -10C36.5685 -10 50 3.43146 50 20C50 36.5685 36.5685 50 20 50C3.43146 50 -10 36.5685 -10 20Z",stroke:"#E5E7EB"}),n.createElement("path",{d:"M20 0C25.3043 0 30.3914 2.10714 34.1421 5.85786C37.8929 9.60859 40 14.6957 40 20C40 25.3043 37.8929 30.3914 34.1421 34.1421C30.3914 37.8929 25.3043 40 20 40C14.6957 40 9.60859 37.8929 5.85786 34.1421C2.10714 30.3914 0 25.3043 0 20C0 14.6957 2.10714 9.60859 5.85786 5.85786C9.60859 2.10714 14.6957 0 20 0ZM18.125 9.375V20C18.125 20.625 18.4375 21.2109 18.9609 21.5625L26.4609 26.5625C27.3203 27.1406 28.4844 26.9062 29.0625 26.0391C29.6406 25.1719 29.4062 24.0156 28.5391 23.4375L21.875 19V9.375C21.875 8.33594 21.0391 7.5 20 7.5C18.9609 7.5 18.125 8.33594 18.125 9.375Z",fill:"#2563EB"})),n.createElement("defs",null,n.createElement("filter",{id:"filter0_d_751_38745",x:-344,y:-36,width:422,height:170,filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB"},n.createElement("feFlood",{floodOpacity:0,result:"BackgroundImageFix"}),n.createElement("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),n.createElement("feMorphology",{radius:2,operator:"erode",in:"SourceAlpha",result:"effect1_dropShadow_751_38745"}),n.createElement("feOffset",{dy:2}),n.createElement("feGaussianBlur",{stdDeviation:6.5}),n.createElement("feColorMatrix",{type:"matrix",values:"0 0 0 0 0.126082 0 0 0 0 0.158639 0 0 0 0 0.218327 0 0 0 0.12 0"}),n.createElement("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_751_38745"}),n.createElement("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_751_38745",result:"shape"})),n.createElement("clipPath",{id:"clip0_751_38745"},n.createElement("rect",{width:1440,height:812,fill:"white",transform:"translate(-612 -121)"})))),as=()=>{var U,z,G,Z,K,Q,J,X,Y,ee,se,te,ae,ne,le,ie;const{t}=Pe(),[x,ve]=n.useState("change"),[we,C]=n.useState(!1),[T,y]=n.useState(!1),l=$e(),_=qe(),u=[{id:"change",name:t("finance.change")},{id:"exchange",name:t("finance.exchange")},{id:"returns",name:t("finance.returns")},{id:"cleaning",name:t("routes.cleaning")},{id:"susp",name:t("finance.susp")}],{data:k}=p((U=l.state)!=null&&U.posId?["get-device"]:null,()=>{var s;return He((s=l.state)==null?void 0:s.posId)},{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),g=(k==null?void 0:k.map(s=>({name:s.props.name,value:s.props.id})))||[],[M,je]=n.useState((z=l.state)==null?void 0:z.ownerId);n.useEffect(()=>{var s;(s=l.state)!=null&&s.ownerId&&je(l.state.ownerId)},[(G=l.state)==null?void 0:G.ownerId]);const{data:a,isValidating:Ne}=p(M?["get-shift-data",M]:null,()=>Ue(M),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),{data:B,isLoading:Ce,isValidating:ye}=p((Z=l.state)!=null&&Z.ownerId?["get-cash-oper-data"]:null,()=>{var s;return ze((s=l.state)==null?void 0:s.ownerId)},{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),{data:R,isLoading:be,isValidating:Ie}=p((K=l.state)!=null&&K.ownerId?["get-cash-oper-return-data"]:null,()=>{var s;return Ge((s=l.state)==null?void 0:s.ownerId)},{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),{data:v,isLoading:Ee}=p((Q=l.state)!=null&&Q.ownerId?["get-cash-oper-clean-data"]:null,()=>{var s;return Ze((s=l.state)==null?void 0:s.ownerId)},{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),{data:F,isLoading:Oe}=p((J=l.state)!=null&&J.ownerId?["get-cash-oper-susp-data"]:null,()=>{var s;return Ke((s=l.state)==null?void 0:s.ownerId)},{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),V=B?[B]:[],D=(R==null?void 0:R.map(s=>{var i;return{...s.props,deviceName:(i=g.find(c=>c.value===s.props.carWashDeviceId))==null?void 0:i.name}}))||[],Te=s=>s.flatMap(({deviceId:i,programData:c})=>c.map(({programName:m,countProgram:j,time:Le},Ae)=>{var re;return{deviceName:Ae===0?(re=g.find(We=>We.value===i))==null?void 0:re.name:null,programName:m,countProgram:j,time:Le}})),L=v&&(v==null?void 0:v.length)>0?Te(v):[],A=(F==null?void 0:F.map(s=>{var i;return{...s,deviceName:(i=g.find(c=>c.value===s.deviceId))==null?void 0:i.name}}))||[],W={type:void 0,sum:void 0,carWashDeviceId:void 0,eventData:void 0,comment:void 0},[r,P]=n.useState(W),{register:d,handleSubmit:$,errors:f,setValue:ke,reset:Me}=Qe(r),{trigger:Re,isMutating:q}=S(["create-cash-oper"],async()=>{var s;return Je({type:T?"REFUND":r.type?r.type:"REPLENISHMENT",sum:r.sum||0,carWashDeviceId:T?void 0:r.carWashDeviceId,eventData:r.eventData,comment:r.comment},(s=l.state)==null?void 0:s.ownerId)}),{trigger:Fe,isMutating:Se}=S(["send-cash-oper"],async()=>{var s;return Xe((s=l.state)==null?void 0:s.ownerId)}),{trigger:_e,isMutating:Be}=S(["return-cash-oper"],async()=>{var s;return Ye((s=l.state)==null?void 0:s.ownerId)}),o=(s,i)=>{const m=["sum","carWashDeviceId"].includes(s)?Number(i):i;P(j=>({...j,[s]:m})),ke(s,i)},w=()=>{P(W),Me()},H=async()=>{await Re()&&(ge(["get-cash-oper-return-data"]),ge(["get-cash-oper-data"]),w(),C(!1),y(!1))},Ve=async()=>{await Fe()&&_(-1)},De=async()=>{await _e()&&_(-1)};return Ne&&!a?e.jsx(N,{columnCount:5}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"w-full sm:w-[400px] h-auto sm:h-[148px] rounded-2xl shadow-card p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-text01 font-semibold",children:t("finance.shiftOver")}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-text02 font-semibold",children:t("finance.curr")}),e.jsxs("div",{className:"flex space-x-2 text-text01",children:[e.jsx("div",{children:a!=null&&a.startWorkingTime?(()=>{const s=new Date(a.startWorkingTime),i=s.getUTCHours(),c=s.getUTCMinutes().toString().padStart(2,"0"),m=i>=12?"PM":"AM";return`${(i%12||12).toString().padStart(2,"0")}:${c} ${m}`})():"09:00 AM"}),e.jsx("div",{children:"-"}),e.jsx("div",{children:a!=null&&a.endWorkingTime?(()=>{const s=new Date(a.endWorkingTime),i=s.getUTCHours(),c=s.getUTCMinutes().toString().padStart(2,"0"),m=i>=12?"PM":"AM";return`${(i%12||12).toString().padStart(2,"0")}:${c} ${m}`})():"05:30 PM"})]})]})]}),e.jsx("div",{className:"w-14 h-14 sm:w-16 sm:h-16 rounded-full bg-[#dbeafe] flex items-center justify-center",children:e.jsx(es,{})})]}),e.jsxs("div",{className:"w-full h-9 bg-[#f0fdf4] rounded flex space-x-2 items-center text-sm px-2 text-[#16a34a]",children:[e.jsx(ce,{icon:"mail",className:"w-[22px] h-[18px]"}),e.jsx("div",{children:t("finance.status")}),e.jsx("div",{className:"font-bold",children:(X=l.state)!=null&&X.status?t(`tables.${l.state.status}`):""})]})]}),e.jsxs("div",{className:"w-full sm:w-72 h-auto sm:h-[148px] rounded-2xl shadow-card p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"text-text01 font-semibold",children:t("finance.grade")}),e.jsx("div",{className:"w-14 h-14 sm:w-16 sm:h-16 rounded-full bg-[#fef9c3] flex items-center justify-center",children:e.jsx(ce,{icon:"star",className:"text-[#ff9066] w-6 h-6 sm:w-8 sm:h-8"})})]}),e.jsx("div",{className:`w-full sm:w-[182px] h-14 ${(a==null?void 0:a.estimation)==="GROSS_VIOLATION"?"bg-[#fef2f2] text-[#dc2626]":(a==null?void 0:a.estimation)==="MINOR_VIOLATION"?"bg-[#fff7ed] text-[#ea580c]":(a==null?void 0:a.estimation)==="ONE_REMARK"?"bg-[#f0fdf4] text-[#16a34a]":"bg-background05"} rounded-lg flex items-center justify-center text-sm px-2`,children:e.jsx("div",{className:"font-extrabold",children:a!=null&&a.estimation?t(`finance.${a==null?void 0:a.estimation}`):""})})]})]}),e.jsx("div",{className:"flex flex-wrap sm:flex-nowrap space-x-4 border-b mb-6 w-full overflow-x-auto",children:u.map(s=>e.jsx("button",{className:`pb-2 flex-1 min-w-[120px] sm:w-60 text-center ${x===s.id?"text-text01 border-b-4 border-primary02":"text-text02"}`,onClick:()=>ve(s.id),children:s.name},s.id))}),e.jsxs("div",{className:"flex space-x-10",children:[((Y=u.find(s=>s.id===x))==null?void 0:Y.name)===t("finance.change")&&e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex flex-wrap gap-3 sm:gap-5",children:[e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("div",{className:"h-28 w-full max-w-xs sm:max-w-sm md:max-w-md px-5 py-4 rounded-lg bg-background05 space-y-3",children:[e.jsx("div",{className:"text-text01 font-bold text-xl sm:text-2xl md:text-3xl",children:(a==null?void 0:a.timeWorkedOut)||"-"}),e.jsx("div",{className:"text-text02/70",children:t("finance.time")})]}),e.jsxs("div",{className:"h-28 w-full max-w-xs sm:max-w-sm md:max-w-md px-5 py-4 rounded-lg bg-background05 space-y-3",children:[e.jsx("div",{className:"text-successFill font-bold text-xl sm:text-2xl md:text-3xl",children:a!=null&&a.prize?`+${a==null?void 0:a.prize} ₽`:""}),e.jsx("div",{className:"text-text02/70",children:t("finance.prize")})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("div",{className:"h-28 w-full max-w-xs sm:max-w-sm md:max-w-md px-5 py-4 rounded-lg bg-background05 space-y-3",children:[e.jsx("div",{className:"text-errorFill font-bold text-xl sm:text-2xl md:text-3xl",children:a!=null&&a.fine?`-${a==null?void 0:a.fine} ₽`:""}),e.jsx("div",{className:"text-text02/70",children:t("finance.fine")})]}),e.jsxs("div",{className:"h-28 w-full max-w-xs sm:max-w-sm md:max-w-lg px-5 py-4 rounded-lg bg-background05 space-y-3",children:[e.jsx("div",{className:"text-text01",children:(a==null?void 0:a.comment)||"-"}),e.jsx("div",{className:"text-text02/70",children:t("equipment.comment")})]})]})]}),e.jsxs("div",{className:"flex flex-wrap justify-start gap-3 sm:gap-4 mt-6 sm:mt-10",children:[l.state.status==="SENT"&&e.jsx(h,{title:t("finance.refund"),type:"outline",handleClick:De,isLoading:Be}),l.state.status!=="SENT"&&e.jsx(h,{title:t("finance.send"),handleClick:Ve,isLoading:Se})]})]}),((ee=u.find(s=>s.id===x))==null?void 0:ee.name)===t("finance.exchange")&&e.jsxs("div",{className:"w-full flex flex-col items-center",children:[e.jsxs("div",{className:"w-full max-w-[1003px] h-fit rounded-2xl shadow-card px-3 sm:px-4 py-4 space-y-2 mt-5",children:[l.state.status!=="SENT"&&e.jsx("button",{className:"px-2 py-1 rounded text-primary02 bg-background07/50 text-sm font-normal",onClick:()=>C(!0),children:t("routes.add")}),Ce||ye?e.jsx(N,{columnCount:de.length}):V.length>0?e.jsx(b,{data:V.map((s,i)=>({...s,id:i})),columns:de}):e.jsx("div",{className:"flex flex-col justify-center items-center",children:e.jsx(I,{title:t("finance.data"),description:t("finance.atThe"),children:e.jsx("img",{src:O,className:"mx-auto max-w-[80%] sm:max-w-[50%]",loading:"lazy",alt:"Timesheet"})})})]}),e.jsxs(oe,{isOpen:we,children:[e.jsxs("div",{className:"flex flex-row items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-text01 text-center sm:text-left",children:t("finance.adding")}),e.jsx(me,{onClick:()=>{w(),C(!1)},className:"cursor-pointer text-text01"})]}),e.jsxs("form",{onSubmit:$(H),className:"space-y-4 text-text02",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(xe,{title:t("finance.operType"),label:t("warehouse.notSel"),options:[{name:t("finance.REFUND"),value:"REFUND"},{name:t("finance.REPLENISHMENT"),value:"REPLENISHMENT"}],classname:"w-full",...d("type",{required:"Type is Required."}),value:r.type,onChange:s=>o("type",s),error:!!f.type,helperText:((se=f.type)==null?void 0:se.message)||""}),e.jsx(E,{type:"number",title:t("finance.sum"),classname:"w-full",value:r.sum,changeValue:s=>o("sum",s.target.value),error:!!f.sum,...d("sum",{required:"Sum is required"}),helperText:((te=f.sum)==null?void 0:te.message)||""}),e.jsx(xe,{title:t("equipment.device"),label:g.length===0?t("warehouse.noVal"):t("warehouse.notSel"),options:g,classname:"w-full",...d("carWashDeviceId"),value:r.carWashDeviceId,onChange:s=>o("carWashDeviceId",s)}),e.jsx(E,{type:"datetime-local",title:t("finance.date"),classname:"w-full",...d("eventData"),value:r.eventData,changeValue:s=>o("eventData",s.target.value)})]}),e.jsx(ue,{title:t("equipment.comment"),classname:"w-full",...d("comment"),value:r.comment,changeValue:s=>o("comment",s.target.value)}),e.jsxs("div",{className:"flex flex-wrap justify-end gap-3 mt-5",children:[e.jsx(h,{title:"Сбросить",handleClick:()=>{w(),C(!1)},type:"outline"}),e.jsx(h,{title:"Сохранить",form:!0,isLoading:q})]})]})]})]}),((ae=u.find(s=>s.id===x))==null?void 0:ae.name)===t("finance.returns")&&e.jsxs("div",{className:"w-full flex flex-col items-center",children:[e.jsxs("div",{className:"w-full max-w-full sm:max-w-[80%] lg:max-w-[1003px] h-fit rounded-2xl shadow-card p-4 mt-5 space-y-2",children:[l.state.status!=="SENT"&&e.jsx("button",{className:"px-2 py-1 rounded text-primary02 bg-background07/50 text-sm font-normal",onClick:()=>y(!0),children:t("routes.add")}),be||Ie?e.jsx(N,{columnCount:fe.length}):D.length>0?e.jsx(b,{data:D,columns:fe}):e.jsx("div",{className:"flex flex-col justify-center items-center",children:e.jsx(I,{title:t("finance.data"),description:t("finance.atThe"),children:e.jsx("img",{src:O,className:"mx-auto max-w-[80%] sm:max-w-[50%]",loading:"lazy",alt:"Timesheet"})})})]}),e.jsxs(oe,{isOpen:T,children:[e.jsxs("div",{className:"flex flex-row items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-text01 text-center sm:text-left",children:t("finance.adding")}),e.jsx(me,{onClick:()=>{w(),y(!1)},className:"cursor-pointer text-text01"})]}),e.jsxs("form",{onSubmit:$(H),className:"space-y-4 text-text02",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(E,{type:"number",title:t("finance.sum"),classname:"w-full",value:r.sum,changeValue:s=>o("sum",s.target.value),error:!!f.sum,...d("sum",{required:"Sum is required"}),helperText:((ne=f.sum)==null?void 0:ne.message)||""}),e.jsx(E,{type:"datetime-local",title:t("finance.date"),classname:"w-full",...d("eventData"),value:r.eventData,changeValue:s=>o("eventData",s.target.value)})]}),e.jsx(ue,{title:t("equipment.comment"),classname:"w-full",...d("comment"),value:r.comment,changeValue:s=>o("comment",s.target.value)}),e.jsxs("div",{className:"flex flex-wrap justify-end gap-3 mt-5",children:[e.jsx(h,{title:"Сбросить",handleClick:()=>{w(),y(!1)},type:"outline"}),e.jsx(h,{title:"Сохранить",form:!0,isLoading:q})]})]})]})]}),((le=u.find(s=>s.id===x))==null?void 0:le.name)===t("routes.cleaning")&&e.jsx("div",{className:"w-full max-w-[1003px] h-fit rounded-2xl shadow-card p-4 mt-5 mx-auto",children:Ee?e.jsx(N,{columnCount:pe.length}):L.length>0?e.jsx(b,{data:L.map((s,i)=>({...s,id:i})),columns:pe,showTotalClean:!0}):e.jsx("div",{className:"flex flex-col justify-center items-center text-center p-4",children:e.jsx(I,{title:t("finance.data"),description:t("finance.atThe"),children:e.jsx("img",{src:O,className:"mx-auto w-3/4 sm:w-1/2 md:w-1/3",loading:"lazy",alt:"Timesheet"})})})}),((ie=u.find(s=>s.id===x))==null?void 0:ie.name)===t("finance.susp")&&e.jsx("div",{className:"w-full max-w-[1003px] h-fit rounded-2xl shadow-card p-4 mt-5 mx-auto",children:Oe?e.jsx(N,{columnCount:he.length}):A.length>0?e.jsx(b,{data:A.map((s,i)=>({...s,id:i})),columns:he}):e.jsx("div",{className:"flex flex-col justify-center items-center text-center p-4",children:e.jsx(I,{title:t("finance.data"),description:t("finance.atThe"),children:e.jsx("img",{src:O,className:"mx-auto w-3/4 sm:w-1/2 md:w-1/3",loading:"lazy",alt:"Timesheet"})})})})]})]})};export{as as default};
