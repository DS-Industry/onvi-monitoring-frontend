import{d as U,e as V,U as $,V as q,a2 as F,a5 as G,Z as J,_ as K,f as Q,r as i,v as E,q as X,w as Y,j as a,D as ee,a6 as C,a7 as ae,af as te,H as se}from"./index-C24s9YLx.js";import{d as oe}from"./index-BzKdJFVM.js";import{F as re}from"./FilterMonitoring-DnjDobpT.js";import{S as ne}from"./Saly-45-CS9u2NZ4.js";import{B as b,C as ie,a as de,L as le,b as ce,p as me,c as pe,d as ge}from"./index-aAWuU0TO.js";import{C as I}from"./CardSkeleton-B53fmzNC.js";ie.register(de,le,ce,me,pe,ge);const Se=()=>{var S;const{t:c}=U(),m=V(),D=$(),P=q(),v=F(),p=G(),L=J(),k=K(),R=Q(),[T,A]=i.useState(!1);i.useEffect(()=>{var e;(e=m.state)!=null&&e.ownerId&&(p(m.state.ownerId),A(!0))},[(S=m.state)==null?void 0:S.ownerId,p]);const[w,N]=i.useState(!1),_={dateStart:D,dateEnd:P,posId:v},[s,M]=i.useState(_),z=e=>{M(t=>({...t,...e})),N(!0),e.posId&&p(e.posId),e.dateStart&&L(e.dateStart),e.dateEnd&&k(e.dateEnd)},{data:g,error:B,isLoading:H,mutate:y}=E(T?["get-pos-programs"]:null,()=>oe(v,{dateStart:s==null?void 0:s.dateStart,dateEnd:s==null?void 0:s.dateEnd}),{revalidateOnFocus:!1}),j=X(),{data:u,isLoading:W,isValidating:Z}=E(["get-pos",j],()=>Y({placementId:j}));i.useEffect(()=>{},[B]),i.useEffect(()=>{y().then(()=>N(!1))},[s,y]);const d=(g==null?void 0:g.map(e=>e).sort((e,t)=>e.id-t.id))||[],O=[...((u==null?void 0:u.map(e=>e).sort((e,t)=>e.id-t.id))||[]).map(e=>({name:e.name,value:e.id}))],x=e=>{const t=["#5E5FCD","#6ECD5E","#A95ECD","#CD5E5E"];return t[e%t.length]},f=d.filter(e=>e.posType==="Portal"),r=(e=>{const t=new Map;return e.forEach(l=>{var n;(n=l.programsInfo)==null||n.forEach(o=>{t.has(o.programName)||t.set(o.programName,{programName:o.programName,counter:0,totalProfit:0});const h=t.get(o.programName);h.counter+=o.counter??0,h.totalProfit+=o.totalProfit??0,t.set(o.programName,h)})}),Array.from(t.values())})(f);return a.jsxs(a.Fragment,{children:[a.jsx(re,{count:d.length,posesSelect:O,handleDataFilter:z,hideCity:!0,hideSearch:!0,hideReset:!0,loadingPos:W||Z}),w||H?a.jsxs("div",{className:"mt-8 space-y-6",children:[a.jsx("div",{className:"space-y-6",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsx(I,{cardHeight:"320px",cardWidth:"100%"}),a.jsx(I,{cardHeight:"320px",cardWidth:"100%"})]})}),a.jsx("div",{children:a.jsx(ee,{columnCount:C.length})})]}):d.length>0?a.jsxs("div",{className:"mt-8 space-y-6",children:[f.length>0&&a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"h-[340px] shadow-card rounded-2xl p-4 pb-6",children:[a.jsx(b,{data:{labels:r.map(e=>e.programName),datasets:[{label:"Кол-во авто",data:r.map(e=>e.counter),backgroundColor:r.map((e,t)=>x(t))}]},options:{maintainAspectRatio:!1,indexAxis:"y",responsive:!0,plugins:{legend:{display:!1},title:{display:!0,text:c("routes.programs"),font:{size:20},color:"black",align:"start"}},scales:{x:{beginAtZero:!0},y:{ticks:{font:{size:12}}}}}}),a.jsx("div",{className:"flex items-center justify-center text-text01",children:c("pos.no")})]}),a.jsx("div",{className:"h-[340px] shadow-card rounded-2xl p-4 pb-6",children:a.jsx(b,{data:{labels:r.map(e=>e.programName),datasets:[{label:"Доход",data:r.map(e=>e.totalProfit),backgroundColor:r.map((e,t)=>x(t))}]},options:{maintainAspectRatio:!1,indexAxis:"x",responsive:!0,plugins:{legend:{display:!1},title:{display:!0,text:c("pos.revBy"),font:{size:20},color:"black",align:"start"}},scales:{y:{beginAtZero:!0},x:{ticks:{autoSkip:!1,font:{size:12},maxRotation:90,minRotation:90,color:function(e){return x(e.index)}}}}}})})]}),a.jsxs("div",{className:"shadow-card rounded-2xl p-4 space-y-6",children:[a.jsx("div",{className:"text-text01 font-semibold text-2xl",children:c("pos.rev")}),a.jsx(ae,{data:d.flatMap((e,t)=>e.programsInfo?e.programsInfo.map((l,n)=>({id:`${t}-${n}`,deviceId:e.id,deviceName:e.name,...l})).sort((l,n)=>l.deviceName.toLowerCase().localeCompare(n.deviceName.toLowerCase())):[]),columns:f.length>0?te:C,titleColumns:[{label:"Device Name",key:"deviceName",render:(e,t)=>a.jsx("span",{className:"font-semibold text-primary02 hover:text-primary02_Hover cursor-pointer",onClick:()=>R("/station/programs/device",{state:{ownerId:t.deviceId}}),children:e})}],titleData:d.map(e=>({title:e.name,deviceName:e.name,deviceId:e.id})).sort((e,t)=>e.deviceName.toLowerCase().localeCompare(t.deviceName.toLowerCase()))})]})]}):a.jsx(a.Fragment,{children:a.jsx(se,{title:"В этом разделе представленны программы",description:"По данной выборке программ не обнаружено",children:a.jsx(ne,{className:"mx-auto"})})})]})};export{Se as default};
