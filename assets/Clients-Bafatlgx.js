import{d as He,b as Ue,r as l,q as We,t as Je,bj as Ke,X as se,a0 as _e,W as Qe,$ as Xe,a1 as Ze,e as et,v as C,x as tt,y as at,z as D,j as t,A as st,aA as nt,I as A,c6 as lt,c7 as it,aq as ne,D as rt,G as ot,H as ct,J as mt,L as R,K as u,aP as dt,Q as ut,B as Y,M as q}from"./index-C24s9YLx.js";import{M as le}from"./MultiInput-D7Pu52yF.js";import{g as gt,a as ht,b as pt,c as xt,u as vt,d as yt}from"./index-BZ4ih03c.js";const bt="/assets/NoMarketing-UJvKprxa.png",kt=()=>{var ee,te,ae;const{t:a}=He(),{buttonOn:ie,setButtonOn:F}=Ue(),[N,re]=l.useState(!1),[w,S]=l.useState("*"),[oe,ce]=l.useState(null),[L,P]=l.useState(void 0),[T,E]=l.useState(void 0),[me,de]=l.useState(""),[ue,ge]=l.useState(""),[$,he]=l.useState(""),[p,B]=l.useState(!1),[x,G]=l.useState(0),v=We(),M=Je(),[pe,H]=l.useState(!1),{filterOn:xe}=Ke(),U=se(),ve=_e(),y=Qe(),[W,ye]=l.useState(""),b=Xe(),J=Ze(),be=et(),fe=se(),{data:V}=C(["get-city"],()=>tt(),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),{data:m,isLoading:z,mutate:K}=C(["get-clients"],()=>gt({placementId:d.placementId,type:d.type,tagIds:d.tagIds,phone:d.phone,page:d.page,size:d.size}),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),{data:c}=C(x!==0?["get-client-by-id"]:null,()=>ht(x),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),f=(m==null?void 0:m.map(e=>({...e,status:a(`tables.${e.status}`)})))||[],je={placementId:v,type:w,tagIds:T,phone:L,page:y,size:U};l.useEffect(()=>{b(1),O(e=>({...e,page:1}))},[be,b]);const[d,O]=l.useState(je),Ie=(m==null?void 0:m.length)||0,g=Math.ceil(Ie/fe);l.useEffect(()=>{y>g&&(b(g>0?g:1),O(e=>({...e,page:g>0?g:1})))},[g,y,b]);const ke=e=>{O(n=>({...n,...e})),H(!0),e.placementId&&M(e.placementId),e.type&&S(e.type),e.tagIds&&E(e.tagIds),e.phone&&P(e.phone),e.size&&ve(e.size)};l.useEffect(()=>{ke({placementId:v,type:w,tagIds:T,phone:L,page:y,size:U})},[xe]),l.useEffect(()=>{K().then(()=>H(!1))},[d,K]),l.useEffect(()=>{!z&&m&&J(m.length)},[m,z,J]);const Ce=()=>{M(v),S("*"),E(void 0),P(void 0)},{data:_,isLoading:Ne,isValidating:we}=C(["get-tags"],()=>pt(),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),Se=(V==null?void 0:V.map(e=>({name:e.region,value:e.id})))||[],Q=_?_.map(e=>e.props):[],Le=e=>{const n=e.map(i=>i.id);r("tagIds",n)},Pe=e=>{const n=e.map(i=>i.id);E(n)},X={type:"",name:"",birthday:void 0,phone:"",email:void 0,comment:"",gender:void 0,inn:void 0,tagIds:[],placementId:void 0,devNumber:void 0,number:void 0,monthlyLimit:void 0},[s,j]=l.useState(X),{register:o,handleSubmit:Te,errors:h,setValue:Ee,reset:Me}=at(s),{trigger:Ve,isMutating:ze}=D(["create-client"],async()=>xt({type:s.type,name:s.name,birthday:s.birthday,phone:s.phone,email:s.email,comment:s.comment,gender:s.gender,inn:s.inn,tagIds:s.tagIds,placementId:s.placementId,devNumber:s.devNumber,number:s.number,monthlyLimit:s.monthlyLimit})),{trigger:Oe,isMutating:De}=D(["update-client"],async()=>vt({clientId:x,name:s.name,type:s.type,inn:s.inn,comment:s.comment,placementId:s.placementId,monthlyLimit:s.monthlyLimit,tagIds:s.tagIds})),{trigger:Ae,isMutating:Re}=D(["create-tag"],async(e,{arg:n})=>yt(n)),r=(e,n)=>{const k=["number","devNumber","placementId","monthlyLimit"].includes(e)?Number(n):n;j(Ge=>({...Ge,[e]:k})),Ee(e,n)},Ye=e=>{G(e),B(!0),F(!0);const n=f.find(i=>i.id===e);n&&j({type:n.type,name:n.name,phone:n.phone,comment:n.comment,tagIds:n.tags.map(i=>i.id),placementId:n.placementId})};l.useEffect(()=>{c&&j(e=>{var n,i,k;return{...e,birthday:c.birthday?c.birthday.split("T")[0]:void 0,email:c.email,inn:c.inn,gender:c.gender,devNumber:(n=c.card)==null?void 0:n.devNumber,number:(i=c.card)==null?void 0:i.number,monthlyLimit:(k=c.card)==null?void 0:k.monthlyLimit}})},[c]);const I=()=>{j(X),B(!1),Me(),G(0),F(!ie)},qe=async()=>{try{if(x)if(await Oe())q(["get-clients"]),I();else throw new Error("Invalid update data.");else if(await Ve())q(["get-clients"]),I();else throw new Error("Invalid response from API")}catch(e){console.error("Error during form submission: ",e)}},Z=[{label:"Тип клиента",key:"type"},{label:"Имя клиента",key:"name"},{label:"Телефон",key:"phone"},{label:"Статус",key:"status"},{label:"Теги",key:"tags",type:"tags"},{label:"Комментарий",key:"comment"}],Fe=(e,n)=>{typeof n=="string"&&he(n)},$e=()=>{const e="0123456789ABCDEF";let n="#";for(let i=0;i<6;i++)n+=e[Math.floor(Math.random()*16)];return n},Be=async()=>{await Ae({name:W,color:$e()})&&q(["get-tags"])};return t.jsxs(t.Fragment,{children:[t.jsxs(st,{count:f.length,hideDateTime:!0,address:v,setAddress:M,handleClear:Ce,hideSearch:!0,children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-text02",children:a("marketing.type")}),t.jsx(nt,{className:"w-full sm:w-80 h-10",placeholder:a("marketing.phys"),options:[{label:a("warehouse.all"),value:"*"},{label:a("marketing.physical"),value:"PHYSICAL"},{label:a("marketing.legal"),value:"LEGAL"}],value:w,onChange:e=>S(e),dropdownRender:e=>t.jsx("div",{style:{maxHeight:100,overflowY:"auto"},children:e})})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-text02",children:a("profile.telephone")}),t.jsx(A,{className:"w-full sm:w-80 h-10",placeholder:a("warehouse.enterPhone"),value:L,onChange:e=>P(e.target.value)})]}),t.jsx(le,{options:Q,value:T,onChange:Pe}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-text02",children:a("marketing.card")}),t.jsx(lt,{className:"w-full sm:w-80",placeholder:a("marketing.enterName"),value:oe,onChange:e=>ce(e),size:"large"})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-text02",children:a("finance.status")}),t.jsx(A,{className:"w-full sm:w-80 h-10",value:me,onChange:e=>de(e.target.value)})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-text02",children:a("marketing.loy")}),t.jsx(A,{className:"w-full sm:w-80 h-10",value:ue,onChange:e=>ge(e.target.value)})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-text02",children:a("marketing.reg")}),t.jsx(it,{className:"w-44 h-10",value:$?ne($):null,onChange:Fe,format:"YYYY-MM-DD",placeholder:a("marketing.reg")})]})]}),z||pe?t.jsx(rt,{columnCount:Z.length}):f.length>0?t.jsx("div",{className:"mt-8 flex flex-col min-h-screen",children:t.jsx(ot,{columns:Z,data:f,onEdit:Ye,navigableFields:[{key:"name",getPath:()=>"/marketing/clients/profile"}],showPagination:!0})}):t.jsx("div",{className:"flex flex-col justify-center items-center",children:t.jsx(ct,{title:a("marketing.noClient"),description:"",children:t.jsx("img",{src:bt,className:"mx-auto",loading:"lazy",alt:"Clients"})})}),t.jsx(mt,{onClose:I,children:t.jsxs("form",{className:"space-y-6",onSubmit:Te(qe),children:[t.jsx("div",{className:"font-semibold text-xl md:text-3xl mb-5 text-text01",children:a("marketing.new")}),t.jsx("span",{className:"font-semibold text-sm text-text01",children:a("warehouse.fields")}),t.jsx("div",{className:"font-semibold text-2xl mb-5 text-text01",children:a("warehouse.basic")}),t.jsx(R,{title:`${a("marketing.type")}*`,label:a("marketing.phys"),classname:"w-80",value:s.type,options:[{name:a("marketing.physical"),value:"PHYSICAL"},{name:a("marketing.legal"),value:"LEGAL"}],...o("type",{required:!p&&"Type is required"}),onChange:e=>r("type",e),error:!!h.type,helperText:((ee=h.type)==null?void 0:ee.message)||""}),t.jsx(u,{type:"",title:`${a("marketing.name")}*`,label:a("marketing.enterName"),classname:"w-96",value:s.name,changeValue:e=>r("name",e.target.value),error:!!h.name,...o("name",{required:!p&&"Name is required"}),helperText:((te=h.name)==null?void 0:te.message)||""}),t.jsx(R,{title:a("marketing.floor"),label:a("warehouse.notSel"),classname:"w-80",options:[{name:a("marketing.man"),value:"Man"},{name:a("marketing.woman"),value:"Woman"}],value:s.gender,...o("gender"),onChange:e=>r("gender",e)}),t.jsx(dt,{title:a("register.date"),classname:"w-40",value:s.birthday?ne(s.birthday):null,changeValue:e=>r("birthday",e?e.format("YYYY-MM-DD"):""),...o("birthday")}),t.jsx(u,{type:"",title:a("profile.telephone"),label:a("warehouse.enterPhone"),classname:"w-96",value:s.phone,changeValue:e=>r("phone",e.target.value),error:!!h.phone,...o("phone",{required:!p&&"Phone is required",pattern:{value:/^\+79\d{9}$/,message:"Phone number must start with +79 and be 11 digits long"}}),helperText:((ae=h.phone)==null?void 0:ae.message)||""}),t.jsx(u,{type:"",title:"E-mail",label:a("marketing.enterEmail"),classname:"w-96",value:s.email,changeValue:e=>r("email",e.target.value),...o("email")}),t.jsx(R,{title:a("pos.city"),label:a("warehouse.notSel"),classname:"w-80",options:Se,value:s.placementId,...o("placementId"),onChange:e=>r("placementId",e)}),t.jsx(ut,{title:a("equipment.comment"),label:a("marketing.about"),inputType:"secondary",classname:"w-96",value:s.comment,changeValue:e=>r("comment",e.target.value),...o("comment")}),s.type==="LEGAL"&&t.jsx(u,{type:"",title:a("marketing.inn"),classname:"w-96",value:s.inn,changeValue:e=>r("inn",e.target.value),...o("inn")}),t.jsx(le,{options:Q,value:s.tagIds,onChange:Le,searchValue:W,setSearchValue:ye,handleChange:Be,isLoading:Re,loadingOptions:Ne||we}),t.jsx("div",{className:"font-semibold text-2xl text-text01",children:a("marketing.loyalty")}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"checkbox",className:"w-[18px] h-[18px]",checked:N,onChange:()=>re(!N)}),t.jsx("div",{children:a("marketing.gen")})]}),N&&t.jsxs("div",{className:"space-y-6",children:[t.jsx(u,{type:"number",title:`${a("marketing.card")}`,label:a("marketing.enterName"),classname:"w-96",value:s.number,changeValue:e=>r("number",e.target.value),...o("number")}),t.jsx(u,{type:"number",title:`${a("marketing.un")}`,label:a("marketing.enterName"),classname:"w-96",value:s.devNumber,changeValue:e=>r("devNumber",e.target.value),...o("devNumber")}),s.type==="LEGAL"&&t.jsx(u,{type:"number",title:a("marketing.limit"),label:a("warehouse.notSel"),classname:"w-80",value:s.monthlyLimit,changeValue:e=>r("monthlyLimit",e.target.value),...o("monthlyLimit")})]}),t.jsxs("div",{className:"flex space-x-4",children:[t.jsx(Y,{title:a("organizations.cancel"),type:"outline",handleClick:()=>{I()}}),t.jsx(Y,{title:a("marketing.delete"),classname:"bg-red-600 hover:bg-red-300"}),t.jsx(Y,{title:a("organizations.save"),form:!0,isLoading:p?De:ze,handleClick:()=>{}})]})]})})]})};export{kt as default};
