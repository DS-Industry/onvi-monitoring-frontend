import{d_ as O,d$ as C,e0 as fe,e1 as Y,e2 as V,e3 as h,e4 as X,e5 as pe,e6 as B,e7 as he,e8 as me,e9 as Se,ea as q,eb as ge,ec as Ee,ed as ye,ee as Te,ef as j,eg as J,eh as _,ei as x,ej as M,ek as K,el as N,em as Z,en as Q,eo as Ne,ep as ve,eq as b,er as L,es as R,et as we,eu as Me,ev as Ie,ew as Re,ex as Ce,ey as be,ez as _e,eA as De,eB as Le,eC as xe,eD as Ae,eE as Oe,eF as Ve,eG as Pe,eH as ke,eI as ze}from"./index-C24s9YLx.js";const P=new WeakMap;function T(e){return P.has(e)}function Fe(e){let t=e;for(;t;){if(!T(t)&&!Y(t))return!1;t=V(t)}return!0}function m(e){return P.get(e)}function Be(e,t){P.set(e,t)}function k(e,t){const n=e.tagName,o=e.value;if(O(e,t)){const s=e.type;return n==="INPUT"&&(s==="button"||s==="submit"||s==="reset")?o:!o||n==="OPTION"?void 0:C}if(n==="OPTION"||n==="SELECT")return e.value;if(!(n!=="INPUT"&&n!=="TEXTAREA"))return o}const Ue=/url\((?:(')([^']*)'|(")([^"]*)"|([^)]*))\)/gm,He=/^[A-Za-z]+:|^\/\//,Ge=/^data:.*,/i;function We(e,t){return e.replace(Ue,(n,o,s,r,u,i)=>{const a=s||u||i;if(!t||!a||He.test(a)||Ge.test(a))return n;const d=o||r||"";return`url(${d}${$e(a,t)}${d})`})}function $e(e,t){try{return fe(e,t).href}catch{return e}}const Ye=/[^a-z1-6-_]/;function ee(e){const t=e.toLowerCase().trim();return Ye.test(t)?"div":t}function U(e,t){return`data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='${e}' height='${t}' style='background-color:silver'%3E%3C/svg%3E`}const y={FullSnapshot:2,IncrementalSnapshot:3,Meta:4,Focus:6,ViewEnd:7,VisualViewport:8,FrustrationRecord:9},w={Document:0,DocumentType:1,Element:2,Text:3,CDATA:4,DocumentFragment:11},S={Mutation:0,MouseMove:1,MouseInteraction:2,Scroll:3,ViewportResize:4,Input:5,TouchMove:6,MediaInteraction:7,StyleSheetRule:8},g={MouseUp:0,MouseDown:1,Click:2,ContextMenu:3,DblClick:4,Focus:5,Blur:6,TouchStart:7,TouchEnd:9},H={Play:0,Pause:1};function te(e){if(!(e===void 0||e.length===0))return e.map(t=>{const n=t.cssRules||t.rules;return{cssRules:Array.from(n,r=>r.cssText),disabled:t.disabled||void 0,media:t.media.length>0?Array.from(t.media):void 0}})}function ne(e,t,n,o){if(t===h.HIDDEN)return null;const s=e.getAttribute(n);if(t===h.MASK&&n!==X&&!pe.includes(n)&&n!==o.actionNameAttribute){const r=e.tagName;switch(n){case"title":case"alt":case"placeholder":return C}if(r==="IMG"&&(n==="src"||n==="srcset")){const u=e;if(u.naturalWidth>0)return U(u.naturalWidth,u.naturalHeight);const{width:i,height:a}=e.getBoundingClientRect();return i>0||a>0?U(i,a):B}if(r==="SOURCE"&&(n==="src"||n==="srcset"))return B;if(r==="A"&&n==="href")return C;if(s&&n.startsWith("data-"))return C;if(r==="IFRAME"&&n==="srcdoc")return C}return!s||typeof s!="string"?s:he(s)?me(s):s}function Xe(e,t,n){if(t===h.HIDDEN)return{};const o={},s=ee(e.tagName),r=e.ownerDocument;for(let c=0;c<e.attributes.length;c+=1){const f=e.attributes.item(c).name,p=ne(e,t,f,n.configuration);p!==null&&(o[f]=p)}if(e.value&&(s==="textarea"||s==="select"||s==="option"||s==="input")){const c=k(e,t);c!==void 0&&(o.value=c)}if(s==="option"&&t===h.ALLOW){const c=e;c.selected&&(o.selected=c.selected)}if(s==="link"){const c=Array.from(r.styleSheets).find(f=>f.href===e.href),l=A(c);l&&c&&(o._cssText=l)}if(s==="style"&&e.sheet){const c=A(e.sheet);c&&(o._cssText=c)}const u=e;if(s==="input"&&(u.type==="radio"||u.type==="checkbox")&&(t===h.ALLOW?o.checked=!!u.checked:O(u,t)&&delete o.checked),s==="audio"||s==="video"){const c=e;o.rr_mediaState=c.paused?"paused":"played"}let i,a;const d=n.serializationContext;switch(d.status){case 0:i=Math.round(e.scrollTop),a=Math.round(e.scrollLeft),(i||a)&&d.elementsScrollPositions.set(e,{scrollTop:i,scrollLeft:a});break;case 1:d.elementsScrollPositions.has(e)&&({scrollTop:i,scrollLeft:a}=d.elementsScrollPositions.get(e));break}return a&&(o.rr_scrollLeft=a),i&&(o.rr_scrollTop=i),o}function A(e){if(!e)return null;let t;try{t=e.rules||e.cssRules}catch{}if(!t)return null;const n=Array.from(t,Se()?qe:se).join("");return We(n,e.href)}function qe(e){if(Je(e)&&e.selectorText.includes(":")){const t=/(\[[\w-]+[^\\])(:[^\]]+\])/g;return e.cssText.replace(t,"$1\\$2")}return se(e)}function se(e){return je(e)&&A(e.styleSheet)||e.cssText}function je(e){return"styleSheet"in e}function Je(e){return"selectorText"in e}function z(e,t){const n=Qe(e,t);if(!n)return null;const o=m(e)||Ze(),s=n;return s.id=o,Be(e,o),t.serializedNodeIds&&t.serializedNodeIds.add(o),s}let Ke=1;function Ze(){return Ke++}function F(e,t){const n=[];return j(e,o=>{const s=z(o,t);s&&n.push(s)}),n}function Qe(e,t){switch(e.nodeType){case e.DOCUMENT_NODE:return et(e,t);case e.DOCUMENT_FRAGMENT_NODE:return tt(e,t);case e.DOCUMENT_TYPE_NODE:return nt(e);case e.ELEMENT_NODE:return st(e,t);case e.TEXT_NODE:return rt(e,t);case e.CDATA_SECTION_NODE:return it()}}function et(e,t){return{type:w.Document,childNodes:F(e,t),adoptedStyleSheets:te(e.adoptedStyleSheets)}}function tt(e,t){const n=Y(e);return n&&t.serializationContext.shadowRootsController.addShadowRoot(e),{type:w.DocumentFragment,childNodes:F(e,t),isShadowRoot:n,adoptedStyleSheets:n?te(e.adoptedStyleSheets):void 0}}function nt(e){return{type:w.DocumentType,name:e.name,publicId:e.publicId,systemId:e.systemId}}function st(e,t){const n=ee(e.tagName),o=ot(e)||void 0,s=ge(Ee(e),t.parentNodePrivacyLevel);if(s===h.HIDDEN){const{width:i,height:a}=e.getBoundingClientRect();return{type:w.Element,tagName:n,attributes:{rr_width:`${i}px`,rr_height:`${a}px`,[X]:ye},childNodes:[],isSVG:o}}if(s===h.IGNORE)return;const r=Xe(e,s,t);let u=[];if(Te(e)&&n!=="style"){let i;t.parentNodePrivacyLevel===s&&t.ignoreWhiteSpace===(n==="head")?i=t:i={...t,parentNodePrivacyLevel:s,ignoreWhiteSpace:n==="head"},u=F(e,i)}return{type:w.Element,tagName:n,attributes:r,childNodes:u,isSVG:o}}function ot(e){return e.tagName==="svg"||e instanceof SVGElement}function rt(e,t){const n=q(e,t.ignoreWhiteSpace||!1,t.parentNodePrivacyLevel);if(n!==void 0)return{type:w.Text,textContent:n}}function it(){return{type:w.CDATA,textContent:""}}function at(e,t,n){return z(e,{serializationContext:n,parentNodePrivacyLevel:t.defaultPrivacyLevel,configuration:t})}function oe(e){return!!e.changedTouches}function D(e){return e.composed===!0&&J(e.target)?e.composedPath()[0]:e.target}const G=25;function ut(e){return Math.abs(e.pageTop-e.offsetTop-window.scrollY)>G||Math.abs(e.pageLeft-e.offsetLeft-window.scrollX)>G}const ct=(e,t)=>{const n=window.visualViewport,o={layoutViewportX:e,layoutViewportY:t,visualViewportX:e,visualViewportY:t};if(n)ut(n)?(o.layoutViewportX=Math.round(e+n.offsetLeft),o.layoutViewportY=Math.round(t+n.offsetTop)):(o.visualViewportX=Math.round(e-n.offsetLeft),o.visualViewportY=Math.round(t-n.offsetTop));else return o;return o},re=e=>({scale:e.scale,offsetLeft:e.offsetLeft,offsetTop:e.offsetTop,pageLeft:e.pageLeft,pageTop:e.pageTop,height:e.height,width:e.width});function E(e,t){return{data:{source:e,...t},type:y.IncrementalSnapshot,timestamp:_()}}const lt=50;function dt(e,t){const{throttled:n,cancel:o}=x(r=>{const u=D(r);if(T(u)){const i=ie(r);if(!i)return;const a={id:m(u),timeOffset:0,x:i.x,y:i.y};t(E(oe(r)?S.TouchMove:S.MouseMove,{positions:[a]}))}},lt,{trailing:!1}),{stop:s}=M(e,document,["mousemove","touchmove"],n,{capture:!0,passive:!0});return{stop:()=>{s(),o()}}}function ie(e){let{clientX:t,clientY:n}=oe(e)?e.changedTouches[0]:e;if(window.visualViewport){const{visualViewportX:o,visualViewportY:s}=ct(t,n);t=o,n=s}if(!Number.isFinite(t)||!Number.isFinite(n)){e.isTrusted&&K("mouse/touch event without x/y");return}return{x:t,y:n}}const W={pointerup:g.MouseUp,mousedown:g.MouseDown,click:g.Click,contextmenu:g.ContextMenu,dblclick:g.DblClick,focus:g.Focus,blur:g.Blur,touchstart:g.TouchStart,touchend:g.TouchEnd};function ft(e,t,n){const o=s=>{const r=D(s);if(N(r,e.defaultPrivacyLevel)===h.HIDDEN||!T(r))return;const u=m(r),i=W[s.type];let a;if(i!==g.Blur&&i!==g.Focus){const c=ie(s);if(!c)return;a={id:u,type:i,x:c.x,y:c.y}}else a={id:u,type:i};const d={id:n.getIdForEvent(s),...E(S.MouseInteraction,a)};t(d)};return M(e,document,Object.keys(W),o,{capture:!0,passive:!0})}const pt=100;function ae(e,t,n,o=document){const{throttled:s,cancel:r}=x(i=>{const a=D(i);if(!a||N(a,e.defaultPrivacyLevel)===h.HIDDEN||!T(a))return;const d=m(a),c=a===document?{scrollTop:Z(),scrollLeft:Q()}:{scrollTop:Math.round(a.scrollTop),scrollLeft:Math.round(a.scrollLeft)};n.set(a,c),t(E(S.Scroll,{id:d,x:c.scrollLeft,y:c.scrollTop}))},pt),{stop:u}=Ne(e,o,"scroll",s,{capture:!0,passive:!0});return{stop:()=>{u(),r()}}}const ht=200;function mt(e,t){const n=ve(e).subscribe(o=>{t(E(S.ViewportResize,o))});return{stop:()=>{n.unsubscribe()}}}function St(e,t){const n=window.visualViewport;if(!n)return{stop:b};const{throttled:o,cancel:s}=x(()=>{t({data:re(n),type:y.VisualViewport,timestamp:_()})},ht,{trailing:!1}),{stop:r}=M(e,n,["resize","scroll"],o,{capture:!0,passive:!0});return{stop:()=>{r(),s()}}}function gt(e,t){return M(e,document,["play","pause"],n=>{const o=D(n);!o||N(o,e.defaultPrivacyLevel)===h.HIDDEN||!T(o)||t(E(S.MediaInteraction,{id:m(o),type:n.type==="play"?H.Play:H.Pause}))},{capture:!0,passive:!0})}function Et(e){function t(s,r){s&&T(s.ownerNode)&&r(m(s.ownerNode))}const n=[L(CSSStyleSheet.prototype,"insertRule",({target:s,parameters:[r,u]})=>{t(s,i=>e(E(S.StyleSheetRule,{id:i,adds:[{rule:r,index:u}]})))}),L(CSSStyleSheet.prototype,"deleteRule",({target:s,parameters:[r]})=>{t(s,u=>e(E(S.StyleSheetRule,{id:u,removes:[{index:r}]})))})];typeof CSSGroupingRule<"u"?o(CSSGroupingRule):(o(CSSMediaRule),o(CSSSupportsRule));function o(s){n.push(L(s.prototype,"insertRule",({target:r,parameters:[u,i]})=>{t(r.parentStyleSheet,a=>{const d=$(r);d&&(d.push(i||0),e(E(S.StyleSheetRule,{id:a,adds:[{rule:u,index:d}]})))})}),L(s.prototype,"deleteRule",({target:r,parameters:[u]})=>{t(r.parentStyleSheet,i=>{const a=$(r);a&&(a.push(u),e(E(S.StyleSheetRule,{id:i,removes:[{index:a}]})))})}))}return{stop:()=>{n.forEach(s=>s.stop())}}}function $(e){const t=[];let n=e;for(;n.parentRule;){const u=Array.from(n.parentRule.cssRules).indexOf(n);t.unshift(u),n=n.parentRule}if(!n.parentStyleSheet)return;const s=Array.from(n.parentStyleSheet.cssRules).indexOf(n);return t.unshift(s),t}function yt(e,t){return M(e,window,["focus","blur"],()=>{t({data:{has_focus:document.hasFocus()},type:y.Focus,timestamp:_()})})}function Tt(e,t,n){const o=e.subscribe(12,s=>{var r,u;s.rawRumEvent.type==="action"&&s.rawRumEvent.action.type==="click"&&(!((u=(r=s.rawRumEvent.action.frustration)===null||r===void 0?void 0:r.type)===null||u===void 0)&&u.length)&&"events"in s.domainContext&&s.domainContext.events&&s.domainContext.events.length&&t({timestamp:s.rawRumEvent.date,type:y.FrustrationRecord,data:{frustrationTypes:s.rawRumEvent.action.frustration.type,recordIds:s.domainContext.events.map(i=>n.getIdForEvent(i))}})});return{stop:()=>{o.unsubscribe()}}}function Nt(e,t){const n=e.subscribe(5,()=>{t({timestamp:_(),type:y.ViewEnd})});return{stop:()=>{n.unsubscribe()}}}function ue(e,t,n=document){const o=e.defaultPrivacyLevel,s=new WeakMap,r=n!==document,{stop:u}=M(e,n,r?["change"]:["input","change"],c=>{const l=D(c);(l instanceof HTMLInputElement||l instanceof HTMLTextAreaElement||l instanceof HTMLSelectElement)&&a(l)},{capture:!0,passive:!0});let i;if(r)i=b;else{const c=[R(HTMLInputElement.prototype,"value",a),R(HTMLInputElement.prototype,"checked",a),R(HTMLSelectElement.prototype,"value",a),R(HTMLTextAreaElement.prototype,"value",a),R(HTMLSelectElement.prototype,"selectedIndex",a)];i=()=>{c.forEach(l=>l.stop())}}return{stop:()=>{i(),u()}};function a(c){const l=N(c,o);if(l===h.HIDDEN)return;const f=c.type;let p;if(f==="radio"||f==="checkbox"){if(O(c,l))return;p={isChecked:c.checked}}else{const v=k(c,l);if(v===void 0)return;p={text:v}}d(c,p);const I=c.name;f==="radio"&&I&&c.checked&&document.querySelectorAll(`input[type="radio"][name="${CSS.escape(I)}"]`).forEach(v=>{v!==c&&d(v,{isChecked:!1})})}function d(c,l){if(!T(c))return;const f=s.get(c);(!f||f.text!==l.text||f.isChecked!==l.isChecked)&&(s.set(c,l),t(E(S.Input,{id:m(c),...l})))}}const vt=100,wt=16;function Mt(e){let t=b,n=[];function o(){t(),e(n),n=[]}const{throttled:s,cancel:r}=x(o,wt,{leading:!1});return{addMutations:u=>{n.length===0&&(t=we(s,{timeout:vt})),n.push(...u)},flush:o,stop:()=>{t(),r()}}}function ce(e,t,n,o){const s=Me();if(!s)return{stop:b,flush:b};const r=Mt(i=>{It(i.concat(u.takeRecords()),e,t,n)}),u=new s(Ie(r.addMutations));return u.observe(o,{attributeOldValue:!0,attributes:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),{stop:()=>{u.disconnect(),r.stop()},flush:()=>{r.flush()}}}function It(e,t,n,o){const s=new Map;e.filter(l=>l.type==="childList").forEach(l=>{l.removedNodes.forEach(f=>{le(f,o.removeShadowRoot)})});const r=e.filter(l=>l.target.isConnected&&Fe(l.target)&&N(l.target,n.defaultPrivacyLevel,s)!==h.HIDDEN),{adds:u,removes:i,hasBeenSerialized:a}=Rt(r.filter(l=>l.type==="childList"),n,o,s),d=Ct(r.filter(l=>l.type==="characterData"&&!a(l.target)),n,s),c=bt(r.filter(l=>l.type==="attributes"&&!a(l.target)),n,s);!d.length&&!c.length&&!i.length&&!u.length||t(E(S.Mutation,{adds:u,removes:i,texts:d,attributes:c}))}function Rt(e,t,n,o){const s=new Set,r=new Map;for(const f of e)f.addedNodes.forEach(p=>{s.add(p)}),f.removedNodes.forEach(p=>{s.has(p)||r.set(p,f.target),s.delete(p)});const u=Array.from(s);_t(u);const i=new Set,a=[];for(const f of u){if(c(f))continue;const p=N(f.parentNode,t.defaultPrivacyLevel,o);if(p===h.HIDDEN||p===h.IGNORE)continue;const I=z(f,{serializedNodeIds:i,parentNodePrivacyLevel:p,serializationContext:{status:2,shadowRootsController:n},configuration:t});if(!I)continue;const v=V(f);a.push({nextId:l(f),parentId:m(v),node:I})}const d=[];return r.forEach((f,p)=>{T(p)&&d.push({parentId:m(f),id:m(p)})}),{adds:a,removes:d,hasBeenSerialized:c};function c(f){return T(f)&&i.has(m(f))}function l(f){let p=f.nextSibling;for(;p;){if(T(p))return m(p);p=p.nextSibling}return null}}function Ct(e,t,n){var o;const s=[],r=new Set,u=e.filter(i=>r.has(i.target)?!1:(r.add(i.target),!0));for(const i of u){if(i.target.textContent===i.oldValue)continue;const d=N(V(i.target),t.defaultPrivacyLevel,n);d===h.HIDDEN||d===h.IGNORE||s.push({id:m(i.target),value:(o=q(i.target,!1,d))!==null&&o!==void 0?o:null})}return s}function bt(e,t,n){const o=[],s=new Map,r=e.filter(i=>{const a=s.get(i.target);return a&&a.has(i.attributeName)?!1:(a?a.add(i.attributeName):s.set(i.target,new Set([i.attributeName])),!0)}),u=new Map;for(const i of r){if(i.target.getAttribute(i.attributeName)===i.oldValue)continue;const d=N(i.target,t.defaultPrivacyLevel,n),c=ne(i.target,d,i.attributeName,t);let l;if(i.attributeName==="value"){const p=k(i.target,d);if(p===void 0)continue;l=p}else typeof c=="string"?l=c:l=null;let f=u.get(i.target);f||(f={id:m(i.target),attributes:{}},o.push(f),u.set(i.target,f)),f.attributes[i.attributeName]=l}return o}function _t(e){e.sort((t,n)=>{const o=t.compareDocumentPosition(n);return o&Node.DOCUMENT_POSITION_CONTAINED_BY?-1:o&Node.DOCUMENT_POSITION_CONTAINS||o&Node.DOCUMENT_POSITION_FOLLOWING?1:o&Node.DOCUMENT_POSITION_PRECEDING?-1:0})}function le(e,t){J(e)&&t(e.shadowRoot),j(e,n=>le(n,t))}function Dt(){const e=new WeakMap;return{set(t,n){t===document&&!document.scrollingElement||e.set(t===document?document.scrollingElement:t,n)},get(t){return e.get(t)},has(t){return e.has(t)}}}const Lt=(e,t,n)=>{const o=new Map,s={addShadowRoot:r=>{if(o.has(r))return;const u=ce(t,e,s,r),i=ue(e,t,r),a=ae(e,t,n,r);o.set(r,{flush:()=>u.flush(),stop:()=>{u.stop(),i.stop(),a.stop()}})},removeShadowRoot:r=>{const u=o.get(r);u&&(u.stop(),o.delete(r))},stop:()=>{o.forEach(({stop:r})=>r())},flush:()=>{o.forEach(({flush:r})=>r())}};return s};function xt(e,t,n,o,s,r){const u=(a=_(),d={status:0,elementsScrollPositions:e,shadowRootsController:t})=>{const{width:c,height:l}=Re(),f=[{data:{height:l,href:window.location.href,width:c},type:y.Meta,timestamp:a},{data:{has_focus:document.hasFocus()},type:y.Focus,timestamp:a},{data:{node:at(document,o,d),initialOffset:{left:Q(),top:Z()}},type:y.FullSnapshot,timestamp:a}];return window.visualViewport&&f.push({data:re(window.visualViewport),type:y.VisualViewport,timestamp:a}),f};r(u());const{unsubscribe:i}=n.subscribe(2,a=>{s(),r(u(a.startClocks.timeStamp,{shadowRootsController:t,status:1,elementsScrollPositions:e}))});return{stop:i}}function At(){const e=new WeakMap;let t=1;return{getIdForEvent(n){return e.has(n)||e.set(n,t++),e.get(n)}}}function Ot(e){const{emit:t,configuration:n,lifeCycle:o}=e;if(!t)throw new Error("emit function is required");const s=f=>{t(f),Ce("record",{record:f});const p=e.viewHistory.findView();be(p.id)},r=Dt(),u=Lt(n,s,r),{stop:i}=xt(r,u,o,n,a,f=>f.forEach(p=>s(p)));function a(){u.flush(),c.flush()}const d=At(),c=ce(s,n,u,document),l=[c,dt(n,s),ft(n,s,d),ae(n,s,r,document),mt(n,s),ue(n,s),gt(n,s),Et(s),yt(n,s),St(n,s),Tt(o,s,d),Nt(o,f=>{a(),s(f)})];return{stop:()=>{u.stop(),l.forEach(f=>f.stop()),i()},flushMutations:a,shadowRootsController:u}}function Vt(e,t,n){const o=new FormData;o.append("segment",new Blob([e],{type:"application/octet-stream"}),`${t.session.id}-${t.start}`);const s={raw_segment_size:n,compressed_segment_size:e.byteLength,...t},r=JSON.stringify(s);return o.append("event",new Blob([r],{type:"application/json"})),{data:o,bytesCount:e.byteLength}}function Pt({context:e,creationReason:t,encoder:n}){let o=0;const s=e.view.id,r={start:1/0,end:-1/0,creation_reason:t,records_count:0,has_full_snapshot:!1,index_in_view:_e(s),source:"browser",...e};De(s);function u(a,d){r.start=Math.min(r.start,a.timestamp),r.end=Math.max(r.end,a.timestamp),r.records_count+=1,r.has_full_snapshot||(r.has_full_snapshot=a.type===y.FullSnapshot);const c=n.isEmpty?'{"records":[':",";n.write(c+JSON.stringify(a),l=>{o+=l,d(o)})}function i(a){if(n.isEmpty)throw new Error("Empty segment flushed");n.write(`],${JSON.stringify(r).slice(1)}
`),n.finish(d=>{Le(r.view.id,d.rawBytesCount),a(r,d)})}return{addRecord:u,flush:i}}const kt=5*Ve;let de=6e4;function zt(e,t,n,o,s,r){return Ft(e,()=>Bt(t.applicationId,n,o),s,r)}function Ft(e,t,n,o){let s={status:0,nextSegmentCreationReason:"init"};const{unsubscribe:r}=e.subscribe(2,()=>{i("view_change")}),{unsubscribe:u}=e.subscribe(11,a=>{i(a.reason)});function i(a){s.status===1&&(s.segment.flush((d,c)=>{const l=Vt(c.output,d,c.rawBytesCount);xe(a)?n.sendOnExit(l):n.send(l)}),Ae(s.expirationTimeoutId)),a!=="stop"?s={status:0,nextSegmentCreationReason:a}:s={status:2}}return{addRecord:a=>{if(s.status!==2){if(s.status===0){const d=t();if(!d)return;s={status:1,segment:Pt({encoder:o,context:d,creationReason:s.nextSegmentCreationReason}),expirationTimeoutId:Oe(()=>{i("segment_duration_limit")},kt)}}s.segment.addRecord(a,d=>{d>de&&i("segment_bytes_limit")})}},stop:()=>{i("stop"),r(),u()}}}function Bt(e,t,n){const o=t.findTrackedSession(),s=n.findView();if(!(!o||!s))return{application:{id:e},session:{id:o.id},view:{id:s.id}}}function Ut(e){const t=Pe();return{addRecord:n=>{const o=e.findView();t.send("record",n,o.id)}}}function Gt(e,t,n,o,s,r){const u=[],i=l=>{e.notify(14,{error:l}),K("Error reported to customer",{"error.message":l.message})},a=r||ke(t.sessionReplayEndpointBuilder,de,i);let d;if(ze())({addRecord:d}=Ut(o));else{const l=zt(e,t,n,o,a,s);d=l.addRecord,u.push(l.stop)}const{stop:c}=Ot({emit:d,configuration:t,lifeCycle:e,viewHistory:o});return u.push(c),{stop:()=>{u.forEach(l=>l())}}}export{Gt as startRecording};
