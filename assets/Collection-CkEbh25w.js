import{d as H,b as K,f as X,a2 as Z,U as J,V as Q,W as Y,X as ee,e as te,a5 as ae,Z as se,_ as oe,$ as ne,a1 as ce,r as s,q as le,v as T,c9 as re,w as ie,j as o,D as ue,G as de,H as pe}from"./index-C24s9YLx.js";import{N as me}from"./NoCollection-BFjlj1pW.js";import{F as ge}from"./FilterMonitoring-DnjDobpT.js";const be=()=>{const{t:r}=H(),I=r("warehouse.all"),{buttonOn:f}=K(),S=X(),N=Z(),j=J(),L=Q(),z=Y(),M=ee(),$=te(),O=ae(),F=se(),R=oe(),b=ne(),h=ce(),[V,C]=s.useState(!1),u=le(),w={dateStart:j,dateEnd:L,page:z,size:M,posId:N||1};s.useEffect(()=>{b(1),D(e=>({...e,page:1}))},[$,b]);const[n,D]=s.useState(w),{data:t,isLoading:d,mutate:P}=T([`get-collections-${n.posId}`],()=>re({dateStart:new Date(n.dateStart),dateEnd:new Date(n.dateEnd),posId:n.posId,placementId:u,page:n.page,size:n.size})),U=e=>{D(E=>({...E,...e})),C(!0),e.posId&&O(e.posId),e.dateStart&&F(new Date(e.dateStart)),e.dateEnd&&R(new Date(e.dateEnd))};s.useEffect(()=>{P().then(()=>C(!1))},[n,P]),s.useEffect(()=>{!d&&(t!=null&&t.totalCount)&&h(t==null?void 0:t.totalCount)},[t==null?void 0:t.totalCount,d,h]);const{data:p,isLoading:W,isValidating:_}=T(["get-pos",u],()=>ie({placementId:u}),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),m=(p==null?void 0:p.map(e=>({name:e.name,value:e.id})))||[],q={name:I,value:"*"};m.unshift(q),s.useEffect(()=>{f&&S("/finance/collection/creation")},[f,S]);const g=s.useMemo(()=>[{label:"№ Документа",key:"id"},{label:"Мойка/Филиал",key:"posName"},{label:"Период",key:"period",type:"period"},{label:"Статус",key:"status"},{label:"Инкассация",key:"sumFact",type:"currency"},{label:"Сумма по картам",key:"sumCard",type:"currency"},{label:"Безналичная оплата",key:"sumVirtual",type:"currency"},{label:"Прибыль",key:"profit",type:"currency"},{label:"Недостача",key:"shortage",type:"currency"}],[]),l=s.useMemo(()=>(t==null?void 0:t.cashCollectionsData)||[],[t]),{columns:v,transformedData:k}=s.useMemo(()=>{if(!l.length)return{columns:g,transformedData:l};const e=[],A=l.map(a=>{const c={...a};return a.cashCollectionDeviceType.forEach((i,x)=>{const y=`collection_${x}`,B=i.typeName||`Склад ${x+1}`;e.some(G=>G.key===y)||e.push({label:B,key:y,type:"currency"}),c[y]=i.typeShortage??0}),c}).map(a=>{var c;return{...a,posName:((c=m.find(i=>i.value===a.posId))==null?void 0:c.name)||"",status:r(`tables.${a.status}`),parsedPeriod:new Date(a.period.split("-")[0])}}).sort((a,c)=>c.parsedPeriod.getTime()-a.parsedPeriod.getTime());return{columns:[...g,...e],transformedData:A}},[l,g]);return o.jsxs("div",{children:[o.jsx(ge,{count:l.length,posesSelect:m,hideSearch:!0,handleDataFilter:U,loadingPos:W||_}),V||d?o.jsx(ue,{columnCount:v.length}):k.length>0?o.jsx("div",{className:"mt-8",children:o.jsx(de,{data:k,columns:v,isDisplayEdit:!0,showPagination:!0,navigableFields:[{key:"posName",getPath:()=>"/finance/collection/creation"}]})}):o.jsx("div",{className:"flex flex-col justify-center items-center",children:o.jsx(pe,{title:r("finance.details"),description:r("finance.at"),children:o.jsx("img",{src:me,className:"mx-auto",loading:"lazy",alt:"No Collection"})})})]})};export{be as default};
