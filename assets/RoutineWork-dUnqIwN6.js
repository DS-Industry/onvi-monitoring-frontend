import{d as lt,a2 as rt,a5 as ot,b as dt,r,q as ct,f as pt,v as D,at as ut,au as mt,w as xt,av as ht,aw as gt,y as ft,z as O,ax as jt,ay as ue,az as bt,j as t,A as vt,aA as me,aB as It,aC as Tt,B as A,aD as H,D as xe,aE as B,aF as yt,aG as he,aH as St,aI as ge,aJ as kt,aK as Dt,aq as W,T as S,aL as wt,aM as fe,aN as Nt,aO as Ct,H as je,G as Et,J as Rt,K as be,L as ve,aP as Ie,F as Te,M as w}from"./index-C24s9YLx.js";import{S as ye}from"./NoEquipment-BCMrYMdq.js";import{M as Ot}from"./MultiInput-D7Pu52yF.js";import{T as At}from"./TipTapEditor-CzqFtJTa.js";import{R as qt}from"./UndoOutlined-Vlk3g7Od.js";const{Text:Se,Title:Pt}=Dt,Ut=()=>{var ie,ne,le,re,oe,de,ce,pe;const{TabPane:N}=H,{t:s}=lt(),ke=s("warehouse.all"),q=rt(),G=ot(),{buttonOn:De,setButtonOn:P}=dt(),[d,F]=r.useState(q),[c,we]=r.useState(""),[h,K]=r.useState(!1),[J,_]=r.useState(0),p=ct(),[Ne,Ce]=r.useState([]),[Ee,C]=r.useState(!1),[Q,Re]=r.useState(0),[Oe,Ae]=r.useState(""),qe=pt(),[X,Pe]=r.useState(""),{data:M,isLoading:Z,isValidating:Fe}=D(["get-tech-tasks",d,p,c],()=>ut({posId:d,placementId:p}),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),{data:V,isLoading:Me}=D(["get-tech-tasks-read",d,p,c],()=>mt({posId:d,placementId:p}),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),{data:$}=D(["get-pos",p],()=>xt({placementId:p}),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),{data:ee,isLoading:Ve,isValidating:$e}=D(["get-tags"],()=>ht(),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),{data:E}=D(["get-tech-task-item"],()=>gt(),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),g=($==null?void 0:$.map(e=>({name:e.name,value:e.id})))||[],Le={name:ke,value:"*"};g.unshift(Le);const Ue=ee?ee.map(e=>({id:e.props.id,name:e.props.name,color:"#A0AEC0"})):[],te={name:"",posId:0,type:"",period:0,startDate:"",endSpecifiedDate:void 0,markdownDescription:void 0,techTaskItem:[],tagIds:[]},[i,b]=r.useState(te),{register:v,handleSubmit:Ye,errors:u,setValue:L,reset:ze}=ft(i),{trigger:He,isMutating:Be}=O(["create-tech-task"],async()=>jt({name:i.name,posId:i.posId,type:i.type,period:i.period,markdownDescription:i.markdownDescription,startDate:new Date(i.startDate),endSpecifiedDate:i.endSpecifiedDate?new Date(i.endSpecifiedDate):void 0,techTaskItem:i.techTaskItem,tagIds:Ne})),{trigger:We,isMutating:Ge}=O(["update-tech-task"],async()=>ue({techTaskId:J,name:i.name,endSpecifiedDate:i.endSpecifiedDate?new Date(i.endSpecifiedDate):void 0,markdownDescription:i.markdownDescription,period:i.period,techTaskItem:i.techTaskItem})),{trigger:Ke,isMutating:se}=O(["update-tech-task-status"],async(e,{arg:a})=>ue(a)),{trigger:Je,isMutating:_e}=O(["create-tag"],async(e,{arg:a})=>bt(a)),f=(e,a)=>{const o=["posId","period"].includes(e)?Number(a):a;b(l=>({...l,[e]:o})),L(e,a)},Qe=e=>{var n;_(e),K(!0),P(!0);const a=U.find(o=>o.id===e);if(a){const o=((n=a.items)==null?void 0:n.map(x=>x.id))||[],l=a.items.map(x=>({id:x.id,title:x.title,description:"This is the description text."}));k(l),T(j.filter(x=>!o.includes(x.id))),b({name:a.name,posId:a.posId,type:a.type,period:a.period,startDate:a.startDate.toString().substring(0,10),endSpecifiedDate:a.endSpecifiedDate&&a.endSpecifiedDate.toString().substring(0,10),techTaskItem:o,markdownDescription:a.markdownDescription,tagIds:a.tags.map(x=>x.id)})}},R=()=>{b(te),K(!1),ze(),_(0),P(!1),T(I),k([])},Xe=async()=>{try{if(J)if(await We())w(["get-tech-tasks",d,p,c]),R();else throw new Error("Invalid update data.");else if(await He())w(["get-tech-tasks",d,p,c]),R();else throw new Error("Invalid response from API")}catch(e){console.error("Error during form submission: ",e)}},U=((ne=(ie=M==null?void 0:M.filter(e=>e.posId===d))==null?void 0:ie.filter(e=>e.status===c||c===""))==null?void 0:ne.map(e=>{var a;return{...e,type:s(`tables.${e.type}`),posName:(a=g.find(n=>n.value===e.posId))==null?void 0:a.name,status:e.status==="ACTIVE"?s("tables.In Progress"):e.status==="FINISHED"?s("tables.Done"):s(`tables.${e.status}`)}}).sort((e,a)=>e.id-a.id))||[],Y=((re=(le=V==null?void 0:V.filter(e=>e.posId===d))==null?void 0:le.filter(e=>e.status===c||c===""))==null?void 0:re.map(e=>{var a;return{...e,posName:((a=g.find(n=>n.value===e.posId))==null?void 0:a.name)||"-",type:s(`tables.${e.type}`),status:s(`tables.${e.status}`)}}).sort((e,a)=>e.id-a.id))||[],I=r.useMemo(()=>(E==null?void 0:E.map(e=>({title:e.props.title,id:e.props.id,description:"This is the description text."})))||[],[E]),[m,z]=r.useState([]),[j,T]=r.useState(I),[y,k]=r.useState([]);r.useEffect(()=>{I&&T(I)},[I]);const Ze=()=>{let e=[...y],a=[...j];const n=j.filter(l=>m.includes(l.id));e=[...e,...n],a=j.filter(l=>!m.includes(l.id)),T(a),k(e),z([]);const o=e.map(l=>l.id);b(l=>({...l,techTaskItem:o})),L("techTaskItem",o)},et=()=>{let e=[...y],a=[...j];const n=y.filter(l=>m.includes(l.id));a=[...a,...n],e=y.filter(l=>!m.includes(l.id)),T(a),k(e),z([]);const o=e.map(l=>l.id);b(l=>({...l,techTaskItem:o})),L("techTaskItem",o)},tt=e=>{const a=e.map(n=>n.id);b(n=>({...n,tagIds:a})),Ce(a)},ae=e=>{z(a=>a.includes(e)?a.filter(n=>n!==e):[...a,e])},st=()=>{F(q),G(q)},at=e=>e===s("tables.ACTIVE")||e===s("tables.SENT")||e===s("tables.In Progress")?t.jsx(S,{color:"green",children:e}):e===s("tables.OVERDUE")||e===s("tables.Done")||e===s("tables.FINISHED")||e===s("tables.PAUSE")?t.jsx(S,{color:"red",children:e}):e===s("tables.SAVED")||e===s("tables.VERIFICATE")?t.jsx(S,{color:"orange",children:e}):t.jsx(S,{color:"default",children:e}),it=async(e,a)=>{await Ke({techTaskId:e,status:a===s("tables.In Progress")?"FINISHED":"ACTIVE"})&&(w(["get-tech-tasks",d,p,c]),w(["get-tech-tasks-read",d,p,c]),C(!1))},nt=async()=>{await Je({name:X})&&w(["get-tags"])};return t.jsxs(t.Fragment,{children:[t.jsxs(vt,{count:U.length,hideDateTime:!0,handleClear:st,hideCity:!0,hideSearch:!0,children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-text02",children:s("equipment.carWash")}),t.jsx(me,{className:"w-full sm:w-80",options:g.map(e=>({label:e.name,value:e.value})),value:d,onChange:e=>{F(e),G(e)},size:"large"})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-text02",children:s("finance.status")}),t.jsx(me,{className:"w-full sm:w-80",options:[{label:s("tables.In Progress"),value:"ACTIVE"},{label:s("tables.OVERDUE"),value:"OVERDUE"},{label:s("tables.Done"),value:"FINISHED"},{label:s("tables.PAUSE"),value:"PAUSE"}],value:c,onChange:e=>we(e),size:"large"})]})]}),t.jsxs(It,{isOpen:Ee,children:[t.jsxs("div",{className:"flex flex-row items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-lg font-semibold text-text01 text-center sm:text-left",children:s("equipment.do")}),t.jsx(Tt,{onClick:()=>{C(!1)},className:"cursor-pointer text-text01"})]}),t.jsxs("div",{className:"flex flex-wrap gap-3 mt-5",children:[t.jsx(A,{title:"Сбросить",handleClick:()=>C(!1),type:"outline"}),t.jsx(A,{title:"Сохранить",isLoading:se,handleClick:()=>it(Q,Oe)})]})]}),t.jsxs(H,{defaultActiveKey:"cards",children:[t.jsx(N,{tab:s("equipment.card"),children:Z||Fe||Me?t.jsx(xe,{columnCount:B.length}):Y.length>0?t.jsx("div",{className:"flex flex-wrap gap-4 justify-start md:justify-start",children:Y.map(e=>{var a;return t.jsx("div",{className:"w-full sm:w-[360px] h-[186px] relative",children:t.jsxs(yt,{variant:"outlined",style:{height:"100%"},styles:{body:{padding:"16px",height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between"}},children:[t.jsxs(he,{justify:"space-between",align:"top",children:[t.jsx(St,{children:t.jsxs(ge,{direction:"vertical",size:"small",children:[t.jsxs(ge,{children:[t.jsx(kt,{style:{color:"#1890ff"}}),t.jsx(Pt,{level:4,className:"cursor-pointer text-text01 hover:text-primary02 hover:underline truncate",style:{margin:0,maxWidth:"150px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},onClick:()=>qe("/equipment/routine/work/list/item",{state:{ownerId:e.id,name:e.name,status:e.status}}),children:e.name})]}),t.jsx(Se,{type:"secondary",children:((a=g.find(n=>n.value===e.posId))==null?void 0:a.name)||""}),t.jsxs(Se,{type:"secondary",style:{display:"block"},children:[s("equipment.deadline"),": ",e.endSpecifiedDate?W(e.endSpecifiedDate).format("DD.MM.YYYY"):"-"]}),e.tags.length>0?t.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.tags.slice(0,3).map(n=>t.jsx(S,{color:"orange",children:n.name},n.id)),e.tags.slice(3).length>0&&t.jsx(wt,{title:e.tags.slice(3).map(n=>n.name).join(", "),children:t.jsxs(S,{color:"default",children:["+",e.tags.slice(3).length," more"]})})]}):t.jsx("div",{className:"h-5",children:"-"})]})}),t.jsx("div",{className:"absolute top-4 right-4",children:at(e.status)})]}),t.jsxs(he,{justify:"center",align:"middle",style:{marginTop:"4px",borderTop:"1px solid #f0f0f0",paddingTop:"8px",height:"48px"},children:[t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"0 16px",height:"100%",width:"150px"},children:t.jsx(fe,{type:"text",loading:e.id===Q&&se,icon:e.status!==s("tables.ACTIVE")?t.jsx(qt,{style:{color:"orange",fontSize:"16px"}}):t.jsx(Nt,{style:{color:"#52c41a",fontSize:"16px"}}),onClick:()=>{C(!0),Re(e.id),Ae(e.status)}})}),t.jsx("div",{style:{width:"1px",height:"24px",backgroundColor:"#f0f0f0",margin:"0 8px",alignSelf:"center"}}),t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"0 16px",height:"100%",width:"150px"},children:t.jsx(fe,{type:"text",icon:t.jsx(Ct,{style:{color:"#f5222d",fontSize:"16px"}})})})]})]})},e.id)})}):t.jsx(je,{title:s("routine.display"),description:"",children:t.jsx("img",{src:ye,className:"mx-auto",loading:"lazy",alt:"ROUTINE"})})},"cards"),t.jsx(N,{tab:s("equipment.table"),children:Z?t.jsx(xe,{columnCount:B.length}):Y.length>0?t.jsx(t.Fragment,{children:t.jsx("div",{className:"mt-8",children:t.jsx(Et,{data:U,columns:B,isCheck:!0,isDisplayEdit:!0,onEdit:Qe,navigableFields:[{key:"name",getPath:()=>"/equipment/routine/work/list/item"}]})})}):t.jsx(je,{title:s("routine.display"),description:"",children:t.jsx("img",{src:ye,className:"mx-auto",loading:"lazy",alt:"ROUTINE"})})},"table")]}),t.jsx(Rt,{onClose:R,children:t.jsxs("form",{className:"space-y-6",onSubmit:Ye(Xe),children:[t.jsx("div",{className:"font-semibold text-xl md:text-3xl mb-5 text-text01",children:s("routes.routine")}),t.jsxs("div",{className:"mb-5 flex",children:[t.jsx("span",{className:"font-semibold text-sm text-text01",children:s("routine.fields")}),t.jsx("span",{className:"text-errorFill",children:"*"}),t.jsx("span",{className:"font-semibold text-sm text-text01",children:s("routine.are")})]}),t.jsx(be,{title:`${s("routine.title")} *`,label:s("routine.enter"),type:"",classname:"w-80",value:i.name,changeValue:e=>f("name",e.target.value),error:!!u.name,...v("name",{required:!h&&"Name is required"}),helperText:((oe=u.name)==null?void 0:oe.message)||""}),t.jsx(ve,{title:s("equipment.carWash"),label:g.length===0?s("warehouse.noVal"):s("warehouse.notSel"),options:g,classname:"w-64",...v("posId",{required:!h&&"Pos ID is required",validate:e=>e!==0||h||"Pos ID is required"}),value:i.posId,onChange:e=>{f("posId",e),F(e)},error:!!u.posId,helperText:(de=u.posId)==null?void 0:de.message}),t.jsx(ve,{title:`${s("routine.type")} *`,label:s("warehouse.notSel"),classname:"w-64",options:[{name:s("tables.ONETIME"),value:"ONETIME"},{name:s("tables.REGULAR"),value:"REGULAR"}],...v("type",{required:!h&&"Type is required"}),value:i.type,onChange:e=>f("type",e),error:!!u.type,helperText:(ce=u.type)==null?void 0:ce.message}),t.jsx(be,{title:`${s("routine.frequency")} *`,type:"number",label:s("warehouse.notSel"),classname:"w-64",...v("period"),value:i.period,changeValue:e=>f("period",e.target.value)}),t.jsx(Ie,{title:`${s("equipment.start")} *`,classname:"w-40",value:i.startDate?W(i.startDate):null,changeValue:e=>f("startDate",e?e.format("YYYY-MM-DD"):""),error:!!u.startDate,...v("startDate",{required:!h&&"Start Date is required"}),helperText:((pe=u.startDate)==null?void 0:pe.message)||"",disabled:h}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-text02",children:s("equipment.end")}),t.jsx(Ie,{classname:"w-40",value:i.endSpecifiedDate?W(i.endSpecifiedDate):null,changeValue:e=>f("endSpecifiedDate",e?e.format("YYYY-MM-DD"):""),error:!!u.endSpecifiedDate,...v("endSpecifiedDate")})]}),t.jsx(Ot,{options:Ue,value:i.tagIds,onChange:tt,searchValue:X,setSearchValue:Pe,handleChange:nt,isLoading:_e,loadingOptions:Ve||$e}),t.jsxs(H,{defaultActiveKey:"editor",children:[t.jsx(N,{tab:s("equipment.text"),children:t.jsx(At,{value:i.markdownDescription,onChange:e=>f("markdownDescription",e)})},"editor"),t.jsx(N,{tab:s("equipment.templates"),children:t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("div",{className:"border rounded w-80",children:[t.jsxs("div",{className:"flex border-b-[1px] bg-background05 text-xs",children:[t.jsx("div",{className:"font-normal text-text01 p-2",children:"Available Tasks"}),t.jsx("div",{className:"ml-auto mr-2 text-text01 p-2",children:j.length})]}),t.jsx("div",{className:"border-b-[1px] h-64 overflow-y-auto w-80",children:j.map(e=>t.jsx("div",{onClick:()=>ae(e.id),className:`border-b-[1px] text-text01 pl-3 p-1 cursor-pointer ${m.includes(e.id)?"bg-background06":"hover:bg-background06"}`,children:t.jsx("div",{className:"font-light text-[11px]",children:e.title})},e.id))})]}),t.jsxs("div",{className:"flex max-w-80 justify-center items-center my-2",children:[t.jsx("button",{className:"border border-r-0 bg-white text-black cursor-pointer",onClick:Ze,disabled:m.length===0,title:"→",children:t.jsx(Te,{icon:"chevrons-down"})}),t.jsx("button",{className:"border border-l-0 bg-white text-black cursor-pointer",onClick:et,disabled:m.length===0,title:"→",children:t.jsx(Te,{icon:"chevrons-up"})})]}),t.jsxs("div",{className:"border rounded w-80",children:[t.jsxs("div",{className:"flex border-b-[1px] bg-background05 text-xs",children:[t.jsx("div",{className:"font-normal text-text01 p-2",children:"Selected Tasks"}),t.jsx("div",{className:"ml-auto mr-2 text-text01 p-2",children:y.length})]}),t.jsx("div",{className:"border-b-[1px] h-64 w-80 overflow-y-auto",children:y.map(e=>t.jsxs("div",{onClick:()=>ae(e.id),className:`border-b-[1px] text-text01 pl-3 p-1 cursor-pointer ${m.includes(e.id)?"bg-background06":"hover:bg-background06"}`,children:[t.jsx("div",{className:"text-[11px] font-light",children:e.title}),t.jsx("div",{className:"text-[10px] font-light text-text01",children:e.description})]},e.id))})]})]})},"templates")]}),t.jsxs("div",{className:"flex justify-start space-x-4",children:[t.jsx(A,{title:s("organizations.cancel"),type:"outline",handleClick:()=>{P(!De),R(),T(I),k([])}}),t.jsx(A,{title:s("routes.create"),form:!0,isLoading:h?Ge:Be,handleClick:()=>{}})]})]})})]})};export{Ut as default};
