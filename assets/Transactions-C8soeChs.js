import{d as N,X as j,W as R,a1 as E,bj as I,r as n,e as A,$ as F,v as T,j as s,A as O,D as z,aM as L,G as M,F as $}from"./index-C24s9YLx.js";import{b as W,c as B}from"./index-CRRG72Lv.js";import{R as G}from"./UndoOutlined-Vlk3g7Od.js";const _=()=>{const{t:o}=N(),b=j(),i=R(),p=E(),{filterOn:x,setFilterOn:v}=I(),[k,g]=n.useState(!1),w=A(),r=F(),C=j(),{data:l}=T(["get-all-report"],()=>W({})),h=n.useMemo(()=>{var t;return((t=l==null?void 0:l.reports)==null?void 0:t.map(a=>({name:a.name,value:a.id})))||[]},[l==null?void 0:l.reports]);n.useEffect(()=>{r(1)},[w,r]);const{data:e,mutate:f,isLoading:u}=T(["get-transaction"],()=>B({page:i,size:b}),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),P=(e==null?void 0:e.count)||0,c=Math.ceil(P/C);n.useEffect(()=>{i>c&&r(c>0?c:1)},[c,i,r]),n.useEffect(()=>{g(!0),f().then(()=>g(!1))},[x,f]),n.useEffect(()=>{!u&&(e!=null&&e.count)&&p(e==null?void 0:e.count)},[e==null?void 0:e.count,u,p]);const d=n.useMemo(()=>((e==null?void 0:e.transactions.map(t=>{var a;return{...t,status:o(`analysis.${t.status}`),reportTemplateId:((a=h.find(m=>m.value===t.reportTemplateId))==null?void 0:a.name)||""}}))||[]).sort((t,a)=>new Date(a.startTemplateAt).getTime()-new Date(t.startTemplateAt).getTime()),[h,o,e==null?void 0:e.transactions]),S=(t,a)=>{const m=`https://storage.yandexcloud.net/onvi-business/report/${a}/${t}`;window.open(m,"_blank")},y=[{label:"Отчет",key:"reportTemplateId"},{label:"Статус",key:"status"},{label:"Дата начала создания",key:"startTemplateAt",type:"date"},{label:"Дата окончания создания",key:"endTemplateAt",type:"date"},{label:"",key:"Download",render:t=>t.status===o("analysis.DONE")&&s.jsx("div",{children:s.jsxs("button",{onClick:()=>S(t.reportKey,t.userId),className:"flex space-x-2 items-center text-primary02",children:[s.jsx("div",{children:o("tables.Download")}),s.jsx($,{icon:"download",className:"w-5 h-5"})]})})}];return s.jsxs("div",{children:[s.jsx(O,{count:d.length,hideSearch:!0,hideCity:!0,hideDateTime:!0,children:void 0}),s.jsx("div",{className:"mt-5",children:u||k?s.jsx(z,{columnCount:y.length}):d.length>0?s.jsxs("div",{className:"space-y-4",children:[s.jsx(L,{onClick:()=>v(!x),icon:s.jsx(G,{style:{color:"orange",fontSize:"24px"}}),style:{width:"48px",height:"48px",display:"flex",alignItems:"center",justifyContent:"center"}}),s.jsx(M,{data:d,columns:y,showPagination:!0})]}):s.jsxs("div",{className:"flex flex-col items-center justify-center mt-40 text-text02",children:[s.jsx("div",{children:o("analysis.there")}),s.jsx("div",{children:o("analysis.you")})]})})]})};export{_ as default};
