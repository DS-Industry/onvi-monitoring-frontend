import{d as te,b as ne,q as re,t as se,v as ie,r as p,g as oe,y as le,z as L,j as n,A as ce,I as de,D as ue,P as F,G as ge,H as pe,J as me,L as M,K as d,Q as U,B as P,M as W}from"./index-C24s9YLx.js";import{S as xe}from"./Saly-11-DFjf1Uz-.js";import{g as ke,c as he,p as ze,d as fe}from"./index-Dx68t6LI.js";const{Search:be}=de,we=()=>{var A,N,V,T,q,S,B,C,I,O,R,D;const{t:r}=te(),{buttonOn:G,setButtonOn:m}=ne(),u=re(),H=se(),{data:x,isLoading:K}=ie(["get-org",u],()=>ke({placementId:u})),[o,f]=p.useState(!1),[b,v]=p.useState(0),[k,y]=p.useState(""),$=oe(),g=(x==null?void 0:x.filter(a=>a.name.toLowerCase().includes(k.toLowerCase())).map(a=>({...a,ownerName:$.name,organizationStatus:r(`tables.${a.organizationStatus}`)})).sort((a,i)=>a.id-i.id))||[],j={fullName:"",organizationType:"",rateVat:"",inn:"",okpo:"",kpp:"",addressRegistration:"",ogrn:"",bik:"",correspondentAccount:"",bank:"",settlementAccount:"",addressBank:"",certificateNumber:"",dateCertificate:""},[t,h]=p.useState(j),{register:l,handleSubmit:J,errors:s,setValue:Q,reset:X}=le(t),{trigger:Y,isMutating:Z}=L("user/organization",async()=>he({fullName:t.fullName,organizationType:t.organizationType,rateVat:t.rateVat,inn:t.inn,okpo:t.okpo,kpp:t.kpp,addressRegistration:t.addressRegistration,ogrn:t.ogrn,bik:t.bik,correspondentAccount:t.correspondentAccount,bank:t.bank,settlementAccount:t.settlementAccount,addressBank:t.addressBank})),{trigger:_}=L("user/organization",async()=>ze({organizationId:b,fullName:t.fullName,rateVat:t.rateVat,inn:t.inn,okpo:t.okpo,kpp:t.kpp,addressRegistration:t.addressRegistration,ogrn:t.ogrn,bik:t.bik,correspondentAccount:t.correspondentAccount,bank:t.bank,settlementAccount:t.settlementAccount,addressBank:t.addressBank})),c=(a,i)=>{h(e=>({...e,[a]:i})),Q(a,i)},ee=async a=>{v(a),f(!0),m(!0);const i=g.find(E=>E.id===a);let e;i!=null&&i.organizationDocumentId&&(e=(await fe(i==null?void 0:i.organizationDocumentId)).props),i&&h({fullName:i.name,organizationType:i.organizationType,rateVat:e!=null&&e.rateVat?e.rateVat:"",inn:e!=null&&e.inn?e.inn:"",okpo:e!=null&&e.okpo?e.okpo:"",kpp:e!=null&&e.kpp?e.kpp:"",addressRegistration:i.address,ogrn:e!=null&&e.ogrn?e.ogrn:"",bik:e!=null&&e.bik?e.bik:"",correspondentAccount:e!=null&&e.correspondentAccount?e.correspondentAccount:"",bank:e!=null&&e.bank?e.bank:"",settlementAccount:e!=null&&e.settlementAccount?e.settlementAccount:"",addressBank:e!=null&&e.addressBank?e.addressBank:"",certificateNumber:e!=null&&e.certificateNumber?e.certificateNumber:"",dateCertificate:e!=null&&e.dateCertificate?e.dateCertificate:""})},z=()=>{h(j),f(!1),X(),v(0),m(!1)},ae=async()=>{try{if(b)if(await _())W(["get-org",u]),z();else throw new Error("Invalid update data.");else if(await Y())W(["get-org",u]);else throw new Error("Invalid org data. Please try again.")}catch(a){console.error("Password change error: ",a)}},w=a=>{y(a)};return n.jsxs(n.Fragment,{children:[n.jsx(ce,{count:g.length,searchTerm:k,setSearchTerm:w,hideDateTime:!0,address:u,setAddress:H,hideSearch:!0,children:n.jsxs("div",{children:[n.jsx("div",{className:"text-sm text-text02",children:"Имя"}),n.jsx(be,{placeholder:"Поиск",className:"w-full sm:w-80",value:k,onChange:a=>y(a.target.value),onSearch:w,size:"large"})]})}),K?n.jsx(ue,{columnCount:F.length}):g.length>0?n.jsx(n.Fragment,{children:n.jsx("div",{className:"mt-8",children:n.jsx(ge,{data:g,columns:F,isDisplayEdit:!0,onEdit:ee})})}):n.jsx(pe,{title:r("organizations.noLegal"),description:r("organizations.addLegal"),children:n.jsx("img",{src:xe,className:"mx-auto",loading:"lazy",alt:"Organization"})}),n.jsx(me,{onClose:z,children:n.jsxs("form",{className:"space-y-6 w-full max-w-2xl mx-auto p-4",onSubmit:J(ae),children:[n.jsx("span",{className:"font-semibold text-xl md:text-3xl mb-5 text-text01",children:r(o?"organizations.update":"organizations.new")}),n.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[n.jsx(M,{title:r("organizations.typeLegal"),options:[{name:r("organizations.legalEntity"),value:"LegalEntity"},{name:r("organizations.ip"),value:"IndividualEntrepreneur"}],inputType:"secondary",classname:"w-80",...l("organizationType",{required:!o&&"Organization Type is required"}),value:t.organizationType,onChange:a=>c("organizationType",a),error:!!s.organizationType,helperText:(A=s.organizationType)==null?void 0:A.message}),n.jsx(M,{title:r("organizations.vatRate"),label:r("organizations.selectBet"),options:[{name:r("organizations.withoutVat"),value:"WithoutVAT"},{name:"10%",value:"Vat10"},{name:"18%",value:"Vat18"},{name:"20%",value:"Vat20"}],inputType:"secondary",classname:"w-80",...l("rateVat",{required:!o&&"Rate VAT is required"}),value:t.rateVat,onChange:a=>c("rateVat",a),error:!!s.rateVat,helperText:(N=s.rateVat)==null?void 0:N.message})]}),n.jsx("div",{className:"text-sm text-text01 font-normal mb-4 uppercase",children:r("organizations.legalDetails")}),n.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[n.jsx(d,{title:r("organizations.tin"),type:"text",classname:"w-80",...l("inn",{required:!o&&"Inn is required"}),value:t.inn,changeValue:a=>c("inn",a.target.value),error:!!s.inn,helperText:(V=s.inn)==null?void 0:V.message}),n.jsx(d,{title:r("organizations.fullName"),type:"text",classname:"w-80",...l("fullName",{required:!o&&"Full Name is required"}),value:t.fullName,changeValue:a=>c("fullName",a.target.value),error:!!s.fullName,helperText:(T=s.fullName)==null?void 0:T.message}),n.jsx(d,{title:r("organizations.okpo"),type:"text",classname:"w-80",...l("okpo",{required:!o&&"Okpo is required"}),value:t.okpo,changeValue:a=>c("okpo",a.target.value),error:!!s.okpo,helperText:(q=s.okpo)==null?void 0:q.message}),n.jsx(d,{title:r("organizations.kpp"),type:"text",classname:"w-80",...l("kpp"),value:t.kpp,changeValue:a=>c("kpp",a.target.value)})]}),n.jsx(U,{title:r("organizations.address"),classname:"w-80 sm:w-96",...l("addressRegistration",{required:!o&&"Registration Address is required"}),value:t.addressRegistration,changeValue:a=>c("addressRegistration",a.target.value),error:!!s.addressRegistration,helperText:(S=s.addressRegistration)==null?void 0:S.message}),n.jsx(d,{title:r("organizations.ogrn"),type:"text",classname:"w-80",...l("ogrn",{required:!o&&"OGRN is required"}),value:t.ogrn,changeValue:a=>c("ogrn",a.target.value),error:!!s.ogrn,helperText:(B=s.ogrn)==null?void 0:B.message}),n.jsx("div",{className:"text-sm text-text01 font-normal mb-4 uppercase",children:r("organizations.bankDetails")}),n.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[n.jsx(d,{title:r("organizations.bik"),type:"text",classname:"w-80",...l("bik",{required:!o&&"BIK is required"}),value:t.bik,changeValue:a=>c("bik",a.target.value),error:!!s.bik,helperText:(C=s.bik)==null?void 0:C.message}),n.jsx(d,{title:r("organizations.corres"),type:"text",classname:"w-80",...l("correspondentAccount",{required:!o&&"Correspondent Account is required"}),value:t.correspondentAccount,changeValue:a=>c("correspondentAccount",a.target.value),error:!!s.correspondentAccount,helperText:(I=s.correspondentAccount)==null?void 0:I.message}),n.jsx(d,{title:r("organizations.bank"),type:"text",classname:"w-80",...l("bank",{required:!o&&"Bank is required"}),value:t.bank,changeValue:a=>c("bank",a.target.value),error:!!s.bank,helperText:(O=s.bank)==null?void 0:O.message}),n.jsx(d,{title:r("organizations.current"),type:"text",classname:"w-80",...l("settlementAccount",{required:!o&&"Settlement Account is required"}),value:t.settlementAccount,changeValue:a=>c("settlementAccount",a.target.value),error:!!s.settlementAccount,helperText:(R=s.settlementAccount)==null?void 0:R.message})]}),n.jsx(U,{title:r("organizations.add"),classname:"w-80 sm:w-96",...l("addressBank",{required:!o&&"Bank Address is required"}),value:t.addressBank,changeValue:a=>c("addressBank",a.target.value),error:!!s.addressBank,helperText:(D=s.addressBank)==null?void 0:D.message}),n.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-4 mt-6",children:[n.jsx(P,{title:r("organizations.cancel"),type:"outline",handleClick:()=>{m(!G),z()}}),n.jsx(P,{title:r("organizations.save"),form:!0,isLoading:Z,handleClick:()=>{}})]})]})})]})};export{we as default};
