import{r as n,d as le,v as I,y as V,z as M,j as e,aB as H,aC as U,K as g,L as T,B as b,bz as d,T as D,F as oe,M as P}from"./index-C24s9YLx.js";import{E as ce}from"./ExpandedCard-Cy-y6nhx.js";import{l as de,o as ue,p as me,q as pe,r as fe}from"./index-BZ4ih03c.js";import{D as S}from"./index-DAyk0lNe.js";const xe=s=>n.createElement("svg",{width:40,height:40,viewBox:"0 0 40 40",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},n.createElement("rect",{width:40,height:40,fill:"#F5F5F5"}),n.createElement("g",{clipPath:"url(#clip0_751_38745)"},n.createElement("rect",{width:1440,height:812,transform:"translate(-312 -513)",fill:"white"}),n.createElement("g",{filter:"url(#filter0_d_751_38745)"},n.createElement("rect",{x:-32,y:-27,width:1128,height:93,rx:16,fill:"white"}),n.createElement("rect",{width:40,height:40,rx:20,fill:"#0B68E1"}),n.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M19.5454 14.2841C19.5451 14.3222 19.545 14.3596 19.545 14.3962C19.545 14.4087 19.5451 14.4211 19.5453 14.4334C19.5437 14.4875 19.5384 14.5248 19.5333 14.5492C19.519 14.5524 19.5 14.5558 19.4752 14.5588C19.4459 14.5622 19.4141 14.5644 19.38 14.5652H19.3171C18.9831 14.5579 18.4527 14.4373 17.7166 14.1694C16.8091 13.8392 16.395 13.6466 16.1697 13.4375C16.0361 13.3134 15.9095 13.1341 15.9095 12.5283C15.9095 11.9747 16.0549 11.5544 16.301 11.3018C16.5179 11.0791 16.9639 10.8333 17.9315 10.9373C18.6071 11.0769 18.9922 11.516 19.2363 12.1745C19.4833 12.8407 19.5399 13.6345 19.5454 14.2841ZM20 11.6373C19.6619 10.8666 19.077 10.2259 18.0697 10.0341C15.7129 9.76359 15.0004 11.1508 15.0004 12.5283C15.0004 13.6463 15.3673 14.1323 16.2607 14.5652H10.9091C10.407 14.5652 10 14.974 10 15.4783V19.9944C10 20.011 10.0009 20.0273 10.0026 20.0435H19.5375V15.4702C19.5375 15.4702 20.2762 15.4513 20.4466 15.4686V20.0435H29.9974C29.9991 20.0273 30 20.011 30 19.9944V15.4783C30 14.974 29.593 14.5652 29.0909 14.5652H23.7393C24.6327 14.1323 24.9996 13.6463 24.9996 12.5283C24.9996 11.1508 24.2871 9.76359 21.9303 10.0341C20.923 10.2259 20.3381 10.8666 20 11.6373ZM20.4547 14.4334C20.4549 14.4211 20.455 14.4087 20.455 14.3962C20.455 14.3596 20.4549 14.3222 20.4546 14.2841C20.4601 13.6345 20.5167 12.8407 20.7637 12.1745C21.0078 11.516 21.3929 11.0769 22.0685 10.9373C23.0361 10.8333 23.4821 11.0791 23.699 11.3018C23.9451 11.5544 24.0905 11.9747 24.0905 12.5283C24.0905 13.1341 23.9639 13.3134 23.8303 13.4375C23.605 13.6466 23.1909 13.8392 22.2834 14.1694C21.5473 14.4373 21.0169 14.5579 20.6829 14.5652H20.62C20.5859 14.5644 20.5541 14.5622 20.5248 14.5588C20.5 14.5558 20.481 14.5524 20.4667 14.5492C20.4616 14.5248 20.4564 14.4875 20.4547 14.4334ZM29.0909 20.9565H20.4466V31H28.1818C28.6839 31 29.0909 30.5912 29.0909 30.087V20.9565ZM10.9091 20.9565H19.5375V31H11.8182C11.3161 31 10.9091 30.5912 10.9091 30.087V20.9565Z",fill:"white"}))),n.createElement("defs",null,n.createElement("filter",{id:"filter0_d_751_38745",x:-43,y:-36,width:1150,height:115,filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB"},n.createElement("feFlood",{floodOpacity:0,result:"BackgroundImageFix"}),n.createElement("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),n.createElement("feMorphology",{radius:2,operator:"erode",in:"SourceAlpha",result:"effect1_dropShadow_751_38745"}),n.createElement("feOffset",{dy:2}),n.createElement("feGaussianBlur",{stdDeviation:6.5}),n.createElement("feColorMatrix",{type:"matrix",values:"0 0 0 0 0.126082 0 0 0 0 0.158639 0 0 0 0 0.218327 0 0 0 0.12 0"}),n.createElement("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_751_38745"}),n.createElement("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_751_38745",result:"shape"})),n.createElement("clipPath",{id:"clip0_751_38745"},n.createElement("rect",{width:1440,height:812,fill:"white",transform:"translate(-312 -513)"})))),Ce=()=>{var F,O,_,A;const{t:s}=le(),[R,u]=n.useState(!1),[q,m]=n.useState(!1),[k,G]=n.useState([]),[c,$]=n.useState(0),{data:p}=I(["get-benefits"],()=>de(),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),{data:r,isLoading:z}=I(c!==0?["get-benefit-by-id",c]:null,()=>ue(c),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),{data:y}=I(["get-benefits-actions"],()=>me(),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),K=(y==null?void 0:y.map(t=>({name:t.props.name,value:t.props.id})))||[],Z=()=>{u(!0)};n.useEffect(()=>{r!=null&&r.props.id&&N({benefitId:r.props.id,name:r.props.name,bonus:r.props.bonus,benefitType:r.props.benefitType})},[r]),n.useEffect(()=>{const t=(p==null?void 0:p.map(a=>a.props))||[];G(t)},[p]);const B={name:"",type:"",bonus:0,benefitActionTypeId:void 0},L={benefitId:c,name:void 0,bonus:void 0,benefitType:void 0},[i,E]=n.useState(B),[l,N]=n.useState(L),{register:f,handleSubmit:W,errors:o,setValue:J,reset:Q}=V(i),{register:C,handleSubmit:X,setValue:Y}=V(l),{trigger:ee,isMutating:te}=M(["create-benefit"],async()=>pe({name:i.name,type:i.type,bonus:i.bonus,benefitActionTypeId:i.benefitActionTypeId})),{trigger:se,isMutating:ne}=M(["update-benefit"],async()=>fe({benefitId:l.benefitId,name:l.name,bonus:l.bonus,benefitType:l.benefitType})),x=(t,a)=>{const j=["bonus","benefitActionTypeId"].includes(t)?Number(a):a;E(w=>({...w,[t]:j})),J(t,a)},v=(t,a)=>{const j=["limitBenefit"].includes(t)?Number(a):a;N(w=>({...w,[t]:j})),Y(t,a)},h=()=>{E(B),Q()},ae=async()=>{try{if(await ee())P(["get-benefits"]),h(),u(!1);else throw new Error("Invalid response from API")}catch(t){console.error("Error during form submission: ",t)}},ie=async()=>{try{if(await se())P(["get-benefits"]),h(),m(!1);else throw new Error("Invalid response from API")}catch(t){console.error("Error during form submission: ",t)}};return e.jsxs("div",{children:[e.jsxs(H,{isOpen:R,children:[e.jsxs("div",{className:"flex flex-row items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-text01 text-center sm:text-left",children:s("marketing.addBen")}),e.jsx(U,{onClick:()=>{h(),u(!1)},className:"cursor-pointer text-text01"})]}),e.jsxs("form",{onSubmit:W(ae),className:"space-y-4 text-text02",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(g,{title:s("equipment.name"),classname:"w-80",inputType:"secondary",value:i.name,changeValue:t=>x("name",t.target.value),error:!!o.name,...f("name",{required:"Name is required"}),helperText:((F=o.name)==null?void 0:F.message)||""}),e.jsx(T,{title:`${s("marketing.ty")} *`,label:s("warehouse.notSel"),options:[{name:s("marketing.CASHBACK"),value:"CASHBACK"},{name:s("marketing.DISCOUNT"),value:"DISCOUNT"},{name:s("marketing.GIFT_POINTS"),value:"GIFT_POINTS"}],classname:"w-80",...f("type",{required:"Type is required"}),value:i.type,onChange:t=>x("type",t),error:!!o.type,helperText:(O=o.type)==null?void 0:O.message}),e.jsx(g,{type:"number",title:s("marketing.bonu"),label:s("marketing.enter"),inputType:"secondary",classname:"w-80",value:i.bonus,changeValue:t=>x("bonus",t.target.value),error:!!o.bonus,...f("bonus",{required:"bonus is required"}),helperText:((_=o.bonus)==null?void 0:_.message)||"",showIcon:!0,IconComponent:e.jsx("div",{className:"text-text02 text-lg",children:"₽"})}),e.jsx(T,{title:`${s("marketing.ty")}`,label:s("warehouse.notSel"),options:K,classname:"w-80",...f("benefitActionTypeId"),value:i.benefitActionTypeId,onChange:t=>x("benefitActionTypeId",t)})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-5",children:[e.jsx(b,{title:"Сбросить",handleClick:()=>{h(),u(!1)},type:"outline"}),e.jsx(b,{title:"Сохранить",form:!0,isLoading:te})]})]})]}),e.jsxs(H,{isOpen:q,children:[e.jsxs("div",{className:"flex flex-row items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-text01 text-center sm:text-left",children:((A=k.find(t=>t.id===c))==null?void 0:A.name)||""}),e.jsx(U,{onClick:()=>{m(!1)},className:"cursor-pointer text-text01"})]}),z?e.jsxs("div",{className:"w-80 space-y-4",children:[e.jsx(d.Input,{active:!0,style:{width:320},size:"default"}),e.jsx(d.Input,{active:!0,style:{width:320},size:"default"}),e.jsx(d.Input,{active:!0,style:{width:320},size:"default"}),e.jsxs("div",{className:"flex gap-3 mt-5",children:[e.jsx(d.Button,{active:!0}),e.jsx(d.Button,{active:!0})]})]}):e.jsxs("form",{onSubmit:X(ie),children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(g,{title:s("equipment.name"),classname:"w-80",inputType:"secondary",value:l.name,changeValue:t=>v("name",t.target.value),...C("name")}),e.jsx(g,{type:"number",title:s("marketing.bonu"),classname:"w-80",inputType:"secondary",value:l.bonus,changeValue:t=>v("bonus",t.target.value),...C("bonus")}),e.jsx(T,{title:`${s("marketing.ty")}`,label:s("warehouse.notSel"),options:[{name:s("marketing.CASHBACK"),value:"CASHBACK"},{name:s("marketing.DISCOUNT"),value:"DISCOUNT"},{name:s("marketing.GIFT_POINTS"),value:"GIFT_POINTS"}],classname:"w-80",...C("benefitType"),value:l.benefitType,onChange:t=>v("benefitType",t)})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-5",children:[e.jsx(b,{title:"Сбросить",handleClick:()=>{m(!1)},type:"outline"}),e.jsx(b,{title:"Сохранить",form:!0,isLoading:ne})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-text02",children:[e.jsx("div",{children:s("marketing.setUp")}),e.jsx("div",{children:s("marketing.if")})]}),k.sort((t,a)=>t.name.localeCompare(a.name)).map(t=>e.jsx(ce,{firstText:t.name,secondText:s(`marketing.${t.benefitType}`),Component:xe,handleClick:()=>{m(!0),$(t.id)},buttonText:s("marketing.updateBen"),children:e.jsx("div",{className:"pl-0 sm:pl-14 space-y-6",children:e.jsxs(S,{column:1,size:"small",labelStyle:{fontWeight:500,color:"#595959"},contentStyle:{color:"#1F1F1F"},children:[e.jsx(S.Item,{label:s("marketing.ty"),children:e.jsx(D,{color:"blue",children:s(`marketing.${t.benefitType}`)})}),e.jsx(S.Item,{label:s("marketing.bonu"),children:e.jsx(D,{color:"gold",children:`${t.bonus} ${t.benefitType!=="DISCOUNT"?"":"%"}`})})]})})})),e.jsxs("div",{className:"flex space-x-2 items-center text-primary02 cursor-pointer",onClick:Z,children:[e.jsx(oe,{icon:"plus"}),e.jsx("div",{children:s("marketing.addBen")})]})]})]})};export{Ce as default};
