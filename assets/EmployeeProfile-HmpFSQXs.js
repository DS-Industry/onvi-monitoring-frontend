import{r as c,j as e,d as de,f as ue,b as pe,e as me,v as _,cF as xe,cQ as he,cG as ve,y as ye,z as ge,cR as fe,F as W,by as be,bz as R,L as G,aP as K,aq as X,K as r,Q as je,c7 as we,B as Ne,M as De}from"./index-C24s9YLx.js";const Se=({month:a,year:w,schedule:F})=>{const[$,N]=c.useState([]),[H,M]=c.useState(0),[z,E]=c.useState(0),L=()=>{const f=new Date(w,g(a),1).getDay(),u=new Date(w,g(a)+1,0).getDate(),d=[],x=f===0?6:f-1,h=g(a),p=A(F,u,w,h);M(p.length),E(u-p.length);for(let t=0;t<x;t++)d.push(e.jsx("div",{className:"border border-borderFill"},`empty-${t}`));for(let t=1;t<=u;t++){const b=p.includes(t);d.push(e.jsx("div",{className:`text-text01 border border-borderFill flex items-center justify-center ${b?"bg-background06":""}`,children:t},t))}const V=x+u,D=V%7===0?0:7-V%7;for(let t=0;t<D;t++)d.push(e.jsx("div",{className:"border border-borderFill"},`empty-end-${t}`));N(d)},A=(f,u,d,x)=>{const{sch:h,repeat:p,date:V}=f,[D,t,b]=V.split("-").map(Number);if(D>d||D===d&&t-1>x)return[];const Y=[];let m;if(D===d&&t-1===x)m=b;else{const O=(new Date(d,x,0).getDate()-b)%(h+p);if(m=O===0?1:h+p-O,m>u)return[]}for(;m<=u;){for(let S=0;S<h&&m+S<=u;S++)Y.push(m+S);if(m+=h+p,m>u)break}return Y};c.useEffect(()=>{L()},[a,w,F]);const g=f=>["January","February","March","April","May","June","July","August","September","October","November","December"].indexOf(f);return e.jsxs("div",{children:[e.jsxs("div",{className:"h-56 w-56 grid grid-cols-7 text-center",children:[e.jsx("div",{className:"font-semibold bg-opacity01 text-text02 flex items-center justify-center",children:"Пн"}),e.jsx("div",{className:"font-semibold bg-opacity01 text-text02 flex items-center justify-center",children:"Вт"}),e.jsx("div",{className:"font-semibold bg-opacity01 text-text02 flex items-center justify-center",children:"Ср"}),e.jsx("div",{className:"font-semibold bg-opacity01 text-text02 flex items-center justify-center",children:"Чт"}),e.jsx("div",{className:"font-semibold bg-opacity01 text-text02 flex items-center justify-center",children:"Пт"}),e.jsx("div",{className:"font-semibold bg-opacity01 text-text02 flex items-center justify-center",children:"Сб"}),e.jsx("div",{className:"font-semibold bg-opacity01 text-text02 flex items-center justify-center",children:"Вс"}),$]}),e.jsxs("div",{className:"text-text01 text-center w-56 mt-2",children:[e.jsxs("div",{className:"flex justify-center",children:["Рабочие дни: ",e.jsx("div",{className:"font-semibold",children:H})]}),e.jsxs("div",{className:"flex justify-center",children:["Выходные дни: ",e.jsx("div",{className:"font-semibold",children:z})]})]})]})},ke=()=>{const{t:a}=de(),[w,F]=c.useState(""),$=ue(),[N,H]=c.useState("info"),{buttonOn:M}=pe(),z=me(),[E,L]=c.useState(z.state.ownerId),[A,g]=c.useState(null),[f,u]=c.useState(null),{data:d}=_(["get-positions"],()=>xe(),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),x=(d==null?void 0:d.map(s=>({name:s.props.name,value:s.props.id,label:s.props.name})))||[],h=s=>{const l=s.trim().split(" ");return l.length<2?"":l.slice(0,2).map(y=>y[0].toUpperCase()).join("")},{data:p,isLoading:V,isValidating:D}=_(E!==0?["get-employee-by-id",E]:null,()=>he(E),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),t=p==null?void 0:p.props,{data:b,isLoading:Y,isValidating:m}=_(["get-workers",t],()=>ve({placementId:"*",hrPositionId:"*",organizationId:"*"}),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),S=(b==null?void 0:b.map(s=>{var l;return{fullName:s.props.name,job:(l=x.find(y=>y.value===s.props.hrPositionId))==null?void 0:l.name,workerId:s.props.id,avatar:s.props.avatar}}).filter(s=>s.fullName.toLowerCase().includes(w.toLowerCase())))||[],O=[{id:"info",name:a("hr.info")},{id:"addi",name:a("hr.addi")},{id:"salary",name:a("hr.salary")}],Z={workerId:z.state.ownerId,hrPositionId:void 0,placementId:void 0,startWorkDate:void 0,phone:void 0,email:void 0,description:void 0,monthlySalary:void 0,dailySalary:void 0,percentageSalary:void 0,gender:void 0,citizenship:void 0,passportSeries:void 0,passportNumber:void 0,passportExtradition:void 0,passportDateIssue:void 0,inn:void 0,snils:void 0};c.useEffect(()=>{t!=null&&t.avatar?g("https://storage.yandexcloud.net/onvi-business/avatar/worker/"+t.avatar):g(null)},[t==null?void 0:t.avatar]);const ee={sch:0,repeat:0,openingHour:0,openingMin:0,closingHour:0,closingMinute:0,date:""},[n,Q]=c.useState(Z),[v,I]=c.useState(ee),se=(s,l)=>{I(B=>({...B,date:l.toString()}));const y=Number(l.toString().split("-")[0]),C=Number(l.toString().split("-")[1]);P(y),T(C-1)};c.useEffect(()=>{t&&Q({...t,workerId:t.id,inn:t.inn===null?void 0:t.inn,snils:t.snils===null?void 0:t.snils,phone:t.phone===null?void 0:t.phone,email:t.email===null?void 0:t.email,gender:t.gender===null?void 0:t.gender,description:t.description===null?void 0:t.description,citizenship:t.citizenship===null?void 0:t.citizenship,passportSeries:t.passportSeries===null?void 0:t.passportSeries,passportExtradition:t.passportExtradition===null?void 0:t.passportExtradition,passportNumber:t.passportNumber===null?void 0:t.passportNumber,startWorkDate:t.startWorkDate?t.startWorkDate.slice(0,10):void 0,passportDateIssue:t.passportDateIssue?t.passportDateIssue.slice(0,10):void 0})},[t]);const{register:i,handleSubmit:U,setValue:te}=ye(n),{trigger:ae}=ge(["update-employee"],async()=>fe({workerId:n.workerId,hrPositionId:n.hrPositionId,placementId:n.placementId,startWorkDate:n.startWorkDate,phone:n.phone,email:n.email,description:n.description,monthlySalary:n.monthlySalary,dailySalary:n.dailySalary,percentageSalary:n.percentageSalary,gender:n.gender,citizenship:n.citizenship,passportSeries:n.passportSeries,passportNumber:n.passportNumber,passportExtradition:n.passportExtradition,passportDateIssue:n.passportDateIssue,inn:n.inn,snils:n.snils},f)),o=(s,l)=>{const C=["monthlySalary","dailySalary","percentageSalary"].includes(s)?Number(l):l;Q(B=>({...B,[s]:C})),te(s,l)},ne=s=>{var y;const l=((y=s.target.files)==null?void 0:y[0])||null;if(u(l),l){const C=new FileReader;C.onloadend=()=>{g(C.result)},C.readAsDataURL(l)}else g(null)},q=async()=>{try{if(await ae())De(["get-employee-by-id",E]);else throw new Error("Invalid response from API")}catch(s){console.error("Error during form submission: ",s)}},J=[{name:"Январь",en:"January"},{name:"Февраль",en:"February"},{name:"Март",en:"March"},{name:"Апрель",en:"April"},{name:"Май",en:"May"},{name:"Июнь",en:"June"},{name:"Июль",en:"July"},{name:"Август",en:"August"},{name:"Сентябрь",en:"September"},{name:"Октябрь",en:"October"},{name:"Ноябрь",en:"November"},{name:"Декабрь",en:"December"}],[j,T]=c.useState(4),[k,P]=c.useState(2024),le=()=>{j>0?T(j-1):(T(9),P(k-1))},re=()=>{j<J.length-3?T(j+1):(T(0),P(k+1))},ie=()=>{P(k-1)},oe=()=>{P(k+1)};c.useEffect(()=>{M&&U(q)()},[M]);const ce=()=>{};return e.jsxs("div",{className:"mt-2",children:[e.jsx("hr",{}),e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsxs("div",{className:"md:w-72 w-full border-r border-opacity01 min-h-screen p-4 space-y-4",children:[e.jsxs("div",{className:"flex space-x-2 text-primary02 cursor-pointer",onClick:()=>$(-1),children:[e.jsx(W,{icon:"chevron-left",className:"h-6 w-6"}),e.jsx("div",{children:a("login.back")})]}),e.jsx(be,{value:w,placeholder:a("hr.search"),searchType:"outlined",onChange:s=>F(s)}),e.jsx("div",{className:"w-full md:w-60 max-h-[480px] overflow-y-auto",children:Y||m?[...Array(5)].map((s,l)=>e.jsxs("div",{className:"flex flex-col space-y-4 mb-4",children:[e.jsx(R.Input,{style:{width:"20%"},active:!0}),e.jsx(R.Input,{style:{width:"30%"},active:!0})]},l)):S.map(s=>e.jsxs("div",{className:"flex rounded-lg hover:bg-background05 p-2.5 cursor-pointer space-x-2",onClick:()=>L(s.workerId),children:[s.avatar?e.jsx("img",{src:"https://storage.yandexcloud.net/onvi-business/avatar/worker/"+s.avatar,alt:"Profile",className:"rounded-full w-10 h-10 object-cover",loading:"lazy"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-background03 flex items-center justify-center text-xs text-text01",children:h(s.fullName)}),e.jsxs("div",{children:[e.jsx("div",{className:"text-text01 font-semibold max-w-44 truncate overflow-hidden whitespace-nowrap",children:s.fullName}),e.jsx("div",{className:"text-text02 text-sm",children:s.job})]})]}))})]}),e.jsxs("div",{className:"px-4 w-full",children:[e.jsx("div",{className:"flex flex-wrap sm:flex-nowrap space-x-4 border-b mb-6 w-fit overflow-x-auto",children:O.map(s=>e.jsx("button",{className:`p-2 flex-1 min-w-[120px] sm:w-40 text-center ${N===s.id?"text-text01 border-b-[3px] border-primary02":"text-text02"}`,onClick:()=>H(s.id),children:s.name},s.id))}),e.jsx("form",{onSubmit:U(q),children:V||D?e.jsx("div",{className:"mt-4",children:[...Array(5)].map((s,l)=>e.jsxs("div",{className:"flex flex-col space-y-4 mb-4",children:[e.jsx(R.Input,{style:{width:"20%"},active:!0}),e.jsx(R.Input,{style:{width:"30%"},active:!0})]},l))}):e.jsxs("div",{className:"mt-4",children:[N==="info"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-text02",children:a("finance.status")}),e.jsxs("div",{className:"rounded-2xl py-[2px] px-2 flex items-center gap-2 w-36 text-[#00A355] bg-[#D1FFEA]",children:[e.jsx("span",{className:"w-2 h-2 bg-[#00A355] rounded-full"}),a("tables.ACTIVE")]})]}),e.jsx(G,{title:`${a("roles.job")}`,label:a("hr.selectPos"),options:x,classname:"w-full md:w-64",...i("hrPositionId"),value:n.hrPositionId,onChange:s=>o("hrPositionId",s),inputType:"secondary"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-text02",children:a("hr.date")}),e.jsx(K,{classname:"w-full md:w-40",value:n.startWorkDate?X(n.startWorkDate):null,changeValue:s=>o("startWorkDate",s?s.format("YYYY-MM-DD"):""),...i("startWorkDate"),inputType:"secondary"})]}),e.jsx(r,{type:"",title:a("profile.telephone"),label:a("warehouse.enterPhone"),classname:"w-full md:w-80",value:n.phone,changeValue:s=>o("phone",s.target.value),...i("phone"),inputType:"secondary"}),e.jsx(r,{type:"",title:"E-mail",label:a("marketing.enterEmail"),classname:"w-full md:w-80",value:n.email,changeValue:s=>o("email",s.target.value),...i("email"),inputType:"secondary"}),e.jsx(je,{title:a("warehouse.desc"),label:a("warehouse.about"),classname:"w-full md:w-80",inputType:"secondary",value:n.description,changeValue:s=>o("description",s.target.value),...i("description")}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-text02",children:a("profile.photo")}),e.jsxs("label",{className:"cursor-pointer",children:[A?e.jsx("img",{src:A,alt:"Profile",className:"rounded-full w-10 h-10 object-cover",loading:"lazy"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-background03 flex items-center justify-center text-xs text-text01",children:h((t==null?void 0:t.name)||"")}),e.jsx("input",{type:"file",accept:"image/*",onChange:ne,className:"hidden"})]})]})]}),N==="addi"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(G,{title:`${a("marketing.floor")}`,label:a("warehouse.notSel"),options:[{name:a("marketing.man"),value:"Man"},{name:a("marketing.woman"),value:"Woman"}],classname:"w-64",...i("gender"),value:n.gender,onChange:s=>o("gender",s)}),e.jsx(r,{type:"",title:a("hr.citi"),label:a("hr.enterCiti"),classname:"w-full md:w-80",value:n.citizenship,changeValue:s=>o("citizenship",s.target.value),...i("citizenship"),inputType:"secondary"}),e.jsx(r,{title:a("hr.passportSeries"),classname:"w-80",inputType:"secondary",value:n.passportSeries,changeValue:s=>o("passportSeries",s.target.value),...i("passportSeries")}),e.jsx(r,{title:a("hr.passportNumber"),classname:"w-80",inputType:"secondary",value:n.passportNumber,changeValue:s=>o("passportNumber",s.target.value),...i("passportNumber")}),e.jsx(r,{title:a("hr.passportExtradition"),classname:"w-80",inputType:"secondary",value:n.passportExtradition,changeValue:s=>o("passportExtradition",s.target.value),...i("passportExtradition")}),e.jsx(K,{title:a("hr.passportDateIssue"),classname:"w-40",inputType:"secondary",value:n.passportDateIssue?X(n.passportDateIssue):null,changeValue:s=>o("passportDateIssue",s?s.format("YYYY-MM-DD"):""),...i("passportDateIssue")}),e.jsx(r,{type:"",title:a("marketing.inn"),classname:"w-full md:w-80",value:n.inn,changeValue:s=>o("inn",s.target.value),...i("inn"),inputType:"secondary"}),e.jsx(r,{type:"",title:a("hr.snils"),classname:"w-full md:w-80",value:n.snils,changeValue:s=>o("snils",s.target.value),...i("snils"),inputType:"secondary"})]}),N==="salary"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(r,{title:`${a("hr.month")}`,type:"number",classname:"w-full md:w-44",showIcon:!0,IconComponent:e.jsx("div",{className:"text-text02 text-xl",children:"₽"}),value:n.monthlySalary,changeValue:s=>o("monthlySalary",s.target.value),...i("monthlySalary"),inputType:"secondary"}),e.jsx(r,{title:`${a("hr.daily")}`,type:"number",classname:"w-full md:w-44",value:n.dailySalary,changeValue:s=>o("dailySalary",s.target.value),...i("dailySalary"),inputType:"secondary",showIcon:!0,IconComponent:e.jsx("div",{className:"text-text02 text-xl",children:"₽"})}),e.jsx(r,{title:`${a("marketing.per")}`,type:"number",classname:"w-full md:w-44",value:n.percentageSalary,changeValue:s=>o("percentageSalary",s.target.value),...i("percentageSalary"),inputType:"secondary",showIcon:!0,IconComponent:e.jsx("div",{className:"text-text02 text-xl",children:"%"})})]}),N==="sch"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"h-72 w-[457px] rounded-lg bg-background05 p-4 space-y-6",children:[e.jsx("div",{className:"text-text01 font-semibold",children:a("hr.auto")}),e.jsxs("div",{className:"flex space-x-3 items-center",children:[e.jsx("div",{className:"text-sm text-text01 font-semibold",children:a("finance.sch")}),e.jsx(r,{type:"number",inputType:"secondary",classname:"w-24",value:v.sch,changeValue:s=>I(l=>({...l,sch:Number(s.target.value)}))}),e.jsx("div",{className:"text-sm text-text02",children:a("finance.thr")}),e.jsx(r,{type:"number",inputType:"secondary",classname:"w-24",value:v.repeat,changeValue:s=>I(l=>({...l,repeat:Number(s.target.value)}))})]}),e.jsxs("div",{className:"flex space-x-3 items-center",children:[e.jsx("div",{className:"text-sm text-text01 font-semibold",children:a("finance.sta")}),e.jsx(we,{onChange:se})]}),e.jsxs("div",{className:"flex space-x-2 items-center",children:[e.jsx("div",{className:"text-text01 font-semibold text-sm",children:a("finance.open")}),e.jsx(r,{type:"number",inputType:"secondary",label:"09 ч",classname:"w-[68px]",value:v.openingHour,changeValue:s=>I(l=>({...l,openingHour:Number(s.target.value)}))}),e.jsx(r,{type:"number",inputType:"secondary",label:"00 м",classname:"w-[68px]",value:v.openingMin,changeValue:s=>I(l=>({...l,openingMin:Number(s.target.value)}))}),e.jsx("div",{className:"text-sm text-text02",children:"-"}),e.jsx(r,{type:"number",inputType:"secondary",label:"09 ч",classname:"w-[68px]",value:v.closingHour,changeValue:s=>I(l=>({...l,closingHour:Number(s.target.value)}))}),e.jsx(r,{type:"number",inputType:"secondary",label:"00 м",classname:"w-[68px]",value:v.closingMinute,changeValue:s=>I(l=>({...l,closingMinute:Number(s.target.value)}))})]}),e.jsx(Ne,{title:a("finance.fill"),handleClick:ce})]}),e.jsxs("div",{className:"flex items-center justify-center w-full md:w-[800px] space-x-4",children:[e.jsx("button",{onClick:ie,className:"p-2 rounded-full bg-background05 text-text03",children:e.jsx(W,{icon:"chevron-left",size:20})}),e.jsx("div",{className:"text-xl font-semibold",children:k}),e.jsx("button",{onClick:oe,className:"p-2 rounded-full bg-background05 text-text03",children:e.jsx(W,{icon:"chevron-right",size:20})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center space-x-4",children:[e.jsx("button",{onClick:le,className:"p-2 rounded-full bg-background05 text-text03 disabled:opacity-50",disabled:j===0,children:e.jsx(W,{icon:"chevron-left",size:20})}),e.jsx("div",{className:"flex flex-col space-y-4 md:space-y-0 md:flex-row md:space-x-4",children:J.slice(j,j+3).map((s,l)=>e.jsxs("div",{children:[e.jsxs("div",{className:"w-56 text-center font-semibold text-text01",children:[s.name," ",k]}),e.jsx(Se,{month:s.en,year:k,schedule:{sch:v.sch,repeat:v.repeat,date:v.date}})]},l))}),e.jsx("button",{onClick:re,className:"p-2 rounded-full bg-background05 text-text03 disabled:opacity-50",disabled:j>=J.length-3,children:e.jsx(W,{icon:"chevron-right",size:20})})]})]})]})})]})]})]})};export{ke as default};
