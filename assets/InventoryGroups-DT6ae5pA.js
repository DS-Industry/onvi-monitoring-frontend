import{r as x,aQ as O,aR as z,bb as _,j as e,bc as q,aM as R,n as K,bd as U,d as A,b as Q,v as G,b4 as J,y as X,z as S,be as Y,bf as Z,D as ee,bg as F,H as te,b9 as ne,J as ae,K as se,L as re,Q as oe,B as N,M as T}from"./index-C24s9YLx.js";var ie={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"},le=function(i,l){return x.createElement(O,z({},i,{ref:l,icon:ie}))},de=x.forwardRef(le),ce={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"plus-circle",theme:"outlined"},ue=function(i,l){return x.createElement(O,z({},i,{ref:l,icon:ce}))},pe=x.forwardRef(ue);const me=({treeData:a,columns:i,isUpdate:l,onUpdate:s,headerBgColor:g="#E4F0FF"})=>{const[u,f]=x.useState([]),p=_(),C=r=>{f(n=>n.includes(r)?n.filter(d=>d!==r):[...n,r])},w=()=>{const r={title:"",dataIndex:"expand",key:"expand",width:50,render:(o,c)=>c.children&&c.children.length>0?e.jsx(R,{type:"text",size:"small",icon:u.includes(c.id)?e.jsx(de,{}):e.jsx(pe,{}),onClick:()=>C(c.id)}):null},n=i.map((o,c)=>({title:o.label,dataIndex:o.key,key:o.key,render:(h,v)=>{if(c===0){const I=v._level??0;return e.jsx("div",{style:{paddingLeft:I*20},children:h})}return h}})),d={title:"",dataIndex:"actions",key:"actions",width:80,render:(o,c)=>e.jsx(K,{requiredPermissions:[{action:"manage",subject:"Warehouse"},{action:"update",subject:"Warehouse"}],userPermissions:p,children:h=>h&&l&&e.jsx(R,{type:"link",icon:e.jsx(U,{className:"text-blue-500 hover:text-blue-700"}),onClick:()=>s&&s(c.id)})})};return[r,...n,d]},y=(r,n=0)=>r.reduce((d,o)=>(d.push({...o,key:o.id,_level:n}),u.includes(o.id)&&o.children&&d.push(...y(o.children,n+1)),d),[]);return e.jsx(q,{columns:w(),dataSource:y(a),pagination:!1,expandable:{expandIcon:()=>null},components:{header:{cell:r=>e.jsx("th",{...r,style:{backgroundColor:g,fontWeight:"semi-bold",paddingLeft:"9px",paddingTop:"20px",paddingBottom:"20px",textAlign:"left",borderRadius:"0px"},className:"border-b border-[1px] border-background02 bg-background06 px-2.5 text-left text-sm font-semibold text-text01 tracking-wider"})},body:{cell:r=>e.jsx("td",{...r,style:{paddingLeft:"9px",paddingTop:"10px",paddingBottom:"10px"}})}},scroll:{x:"max-content"}})},xe=a=>{const i={},l=[];return a.forEach(s=>{i[s.id]={...s,children:[]}}),a.forEach(s=>{var g,u;s.ownerCategoryId===null?l.push(i[s.id]):i[s.ownerCategoryId]&&((u=(g=i[s.ownerCategoryId])==null?void 0:g.children)==null||u.push(i[s.id]))}),l},he=()=>{var E;const{t:a}=A(),{buttonOn:i,setButtonOn:l}=Q(),[s,g]=x.useState(!1),[u,f]=x.useState(0),{data:p,isLoading:C}=G(["get-category"],()=>J(),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),w=(p==null?void 0:p.map(t=>({name:t.props.name,value:t.props.id})))||[],y=(p==null?void 0:p.map(t=>t.props))||[],r={name:"",description:"",ownerCategoryId:void 0},[n,d]=x.useState(r),{register:o,handleSubmit:c,errors:h,setValue:v,reset:I}=X(n),{trigger:B,isMutating:D}=S(["create-inventory"],async()=>Y({name:n.name,description:n.description,ownerCategoryId:n.ownerCategoryId})),{trigger:P,isMutating:V}=S(["update-inventory"],async()=>Z({name:n.name,description:n.description},u)),j=(t,m)=>{const H=["ownerCategoryId"].includes(t)?Number(m):m;d(W=>({...W,[t]:H})),v(t,m)},L=t=>{f(t),g(!0),l(!0);const m=y.find(M=>M.id===t);m&&d({name:m.name,description:m.description,ownerCategoryId:m.ownerCategoryId})},b=()=>{d(r),g(!1),I(),f(0),l(!i)},$=async()=>{try{if(u)if(await P())T(["get-category"]),b();else throw new Error("Invalid update data.");else if(await B())T(["get-category"]),b();else throw new Error("Invalid response from API")}catch(t){console.error("Error during form submission: ",t)}},k=xe(y);return e.jsxs(e.Fragment,{children:[C?e.jsx(ee,{columnCount:F.length}):k.length>0?e.jsx("div",{className:"mt-8",children:e.jsx(me,{treeData:k,columns:F,isUpdate:!0,onUpdate:L})}):e.jsx(te,{title:a("warehouse.nomenclature"),description:"",children:e.jsx("img",{src:ne,className:"mx-auto",loading:"lazy",alt:"Inventory"})}),e.jsx(ae,{classname:"w-[440px]",onClose:b,children:e.jsxs("form",{className:"space-y-6",onSubmit:c($),children:[e.jsx("div",{className:"font-semibold text-xl md:text-3xl mb-5 text-text01",children:a("warehouse.groupCreate")}),e.jsx("span",{className:"font-semibold text-sm text-text01",children:a("warehouse.fields")}),e.jsx(se,{title:a("profile.name"),label:a("warehouse.enter"),type:"text",classname:"w-80",value:n.name,changeValue:t=>j("name",t.target.value),error:!!h.name,...o("name",{required:!s&&"Name is required"}),helperText:((E=h.name)==null?void 0:E.message)||""}),e.jsx(re,{title:`${a("warehouse.included")}`,options:w,classname:"w-64",...o("ownerCategoryId"),value:n.ownerCategoryId,onChange:t=>j("ownerCategoryId",t),isDisabled:s}),e.jsx(oe,{title:a("warehouse.desc"),label:a("warehouse.about"),classname:"w-80",inputType:"secondary",value:n.description,changeValue:t=>j("description",t.target.value)}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(N,{title:a("warehouse.reset"),type:"outline",handleClick:()=>{b()}}),e.jsx(N,{title:a("routes.create"),form:!0,isLoading:s?V:D,handleClick:()=>{}})]})]})})]})};export{he as default};
