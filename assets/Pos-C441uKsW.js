import{d as je,r as j,q as ve,t as Se,b as fe,v as y,w as Oe,x as be,y as we,z as Pe,j as s,A as Ie,I as ke,D as Ne,E as se,G as Te,H as We,J as qe,K as u,L as te,B as z,M as ze}from"./index-C24s9YLx.js";import{P as Ce}from"./EmptyPos-34gV-mjA.js";import{N as ae}from"./Notification-KpAXhuNN.js";import{p as Ve}from"./index-BzKdJFVM.js";import{g as $e,a as Be,b as Fe}from"./index-Dx68t6LI.js";const{Search:De}=ke,Ae=async t=>t?Be(t):null,re=async t=>t?Fe(t):null,Ue=()=>{var E,H,L,M,R,U,G,J,K,Q,X,Y;const{t}=je(),[C,V]=j.useState(!0),[$,b]=j.useState(""),d=ve(),ne=Se(),{buttonOn:le,setButtonOn:oe}=fe(),{data:i,isLoading:ie}=y(["get-pos",d],()=>Oe({placementId:d}),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),{data:p}=y(le?["get-org",d]:null,()=>$e({placementId:d})),{data:w}=y(["get-placement"],()=>be(),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),B=(w==null?void 0:w.map(e=>({country:e.country,city:e.region,value:e.id})))||[],[v,me]=j.useState(null),[S,ue]=j.useState(null),F=(p==null?void 0:p.map(e=>e).sort((e,a)=>e.id-a.id))||[],ce=(p==null?void 0:p.map(e=>({name:e.name,value:e.id})))||[],D={name:"",monthlyPlan:null,timeWork:"",posMetaData:"",city:"",location:"",lat:null,lon:null,organizationId:null,carWashPosType:"",minSumOrder:null,maxSumOrder:null,stepSumOrder:null},[r,f]=j.useState(D),{register:o,handleSubmit:de,errors:n,setValue:P,reset:pe}=we(r),{trigger:xe,isMutating:ge}=Pe("user/pos",async()=>Ve({name:r.name,monthlyPlan:r.monthlyPlan,timeWork:r.timeWork,address:{city:r.city,location:r.location,lat:r.lat,lon:r.lon},organizationId:r.organizationId,carWashPosType:r.carWashPosType,minSumOrder:r.minSumOrder,maxSumOrder:r.maxSumOrder,stepSumOrder:r.stepSumOrder})),m=(e,a)=>{const c=["monthlyPlan","stepSumOrder","minSumOrder","maxSumOrder","lat","lon"].includes(e)?Number(a):a;f(O=>({...O,[e]:c})),P(e,a)},A=(e,a)=>{e==="startHour"?(me(a),f(l=>({...l,timeWork:`${a}${S??""}`})),P("timeWork",`${a}${S??""}`)):(ue(a),f(l=>({...l,timeWork:`${v??""}${a}`})),P("timeWork",`${v??""}${a}`))},I=()=>{f(D),pe(),oe(!1)},he=async()=>{try{if(await xe())ze(["get-pos",d]),I();else throw new Error("Invalid response from API")}catch(e){console.error("Error during form submission: ",e)}},x=Array.from(new Set(i==null?void 0:i.map(e=>e.organizationId))),k=Array.from(new Set(i==null?void 0:i.map(e=>e.createdById))),N=Array.from(new Set(i==null?void 0:i.map(e=>e.updatedById))),{data:T}=y(x.length?["organizationContacts",x]:null,async()=>(await Promise.all(x.map(Ae))).reduce((a,l,c)=>(l&&(a[x[c]]=l),a),{})),{data:g}=y(x.length?["createContacts",k]:null,async()=>(await Promise.all(k.map(re))).reduce((a,l,c)=>(l&&(a[k[c]]=l),a),{})),{data:h}=y(x.length?["updateContacts",N]:null,async()=>(await Promise.all(N.map(re))).reduce((a,l,c)=>(l&&(a[N[c]]=l),a),{})),W=((E=i==null?void 0:i.map(e=>{var a,l,c,O,Z,_,ee;return{...e,organizationName:((a=T==null?void 0:T[e.organizationId])==null?void 0:a.name)||"-",status:t(`tables.${e.posStatus}`),createdByName:`${((l=g==null?void 0:g[e.createdById])==null?void 0:l.name)||""} ${((c=g==null?void 0:g[e.createdById])==null?void 0:c.surname)||""}`||"-",updatedByName:`${((O=h==null?void 0:h[e.updatedById])==null?void 0:O.name)||""} ${((Z=h==null?void 0:h[e.updatedById])==null?void 0:Z.surname)||""}`||"-",city:((_=B.find(q=>q.value===e.placementId))==null?void 0:_.city)||"",country:((ee=B.find(q=>q.value===e.placementId))==null?void 0:ee.country)||""}}))==null?void 0:E.filter(e=>e.name.toLowerCase().includes($.toLowerCase())).sort((e,a)=>e.id-a.id))||[],ye=()=>{b("")};return s.jsxs(s.Fragment,{children:[s.jsx(Ie,{count:W.length,hideDateTime:!0,handleClear:ye,address:d,setAddress:ne,hideSearch:!0,children:s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-text02",children:t("equipment.carWash")}),s.jsx(De,{placeholder:"Поиск",className:"w-full sm:w-80",value:$,onChange:e=>b(e.target.value),onSearch:e=>b(e),size:"large"})]})}),ie?s.jsx(Ne,{columnCount:se.length}):W.length>0?s.jsx(s.Fragment,{children:s.jsx("div",{className:"mt-8",children:s.jsx(Te,{data:W,columns:se,isDisplayEdit:!0,navigableFields:[{key:"name",getPath:()=>"/station/enrollments/devices"}]})})}):s.jsxs(s.Fragment,{children:[C&&F.length===0&&s.jsx("div",{className:"mt-2",children:s.jsx(ae,{title:t("pos.companyName"),message:t("pos.createObject"),link:t("pos.goto"),linkUrl:"/administration/legalRights",onClose:()=>V(!1)})}),s.jsx(We,{title:t("pos.noObject"),description:t("pos.addCar"),children:s.jsx("img",{src:Ce,className:"mx-auto",loading:"lazy",alt:"Pos"})})]}),s.jsxs(qe,{onClose:I,children:[C&&F.length===0&&s.jsx(ae,{title:t("organizations.legalEntity"),message:t("pos.createObject"),link:t("pos.goto"),linkUrl:"/administration/legalRights",onClose:()=>V(!1)}),s.jsxs("form",{className:"space-y-6 w-full max-w-2xl mx-auto p-4",onSubmit:de(he),children:[s.jsx("span",{className:"font-semibold text-xl md:text-3xl mb-5",children:t("pos.creating")}),s.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[s.jsx(u,{title:t("pos.name"),type:"text",label:t("pos.example"),classname:"w-80 sm:w-96",...o("name",{required:"Name is required"}),value:r.name,changeValue:e=>m("name",e.target.value),error:!!n.name,helperText:(H=n.name)==null?void 0:H.message}),s.jsx(u,{title:t("pos.city"),type:"text",label:t("pos.address"),classname:"w-80 sm:w-96",...o("city",{required:"City is required"}),value:r.city,changeValue:e=>m("city",e.target.value),error:!!n.city,helperText:(L=n.city)==null?void 0:L.message}),s.jsx(u,{title:t("pos.location"),type:"text",label:t("pos.location"),classname:"w-80 sm:w-96",...o("location",{required:"Location is required"}),value:r.location,changeValue:e=>m("location",e.target.value),error:!!n.location,helperText:(M=n.location)==null?void 0:M.message}),s.jsx(u,{title:t("pos.lat"),type:"number",classname:"w-48",...o("lat"),value:r.lat,changeValue:e=>m("lat",e.target.value)}),s.jsx(u,{title:t("pos.lon"),type:"number",classname:"w-48",...o("lon"),value:r.lon,changeValue:e=>m("lon",e.target.value)}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm text-text02",children:t("pos.opening")}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx(u,{type:"number",classname:"w-40",value:v!==null?v:"",changeValue:e=>A("startHour",e.target.value),...o("timeWork",{required:"Time Work is required"}),error:!!n.timeWork,helperText:(R=n.timeWork)==null?void 0:R.message}),s.jsx("div",{className:"flex justify-center items-center text-text02",children:" : "}),s.jsx(u,{type:"number",classname:"w-40",value:S!==null?S:"",changeValue:e=>A("endHour",e.target.value),...o("timeWork",{required:"Time Work is required"}),error:!!n.timeWork,helperText:(U=n.timeWork)==null?void 0:U.message})]}),s.jsxs("div",{className:"flex mt-2",children:[s.jsx("input",{type:"checkbox"}),s.jsx("div",{className:"text-text02 ml-2",children:t("pos.clock")})]})]}),s.jsx(u,{title:t("pos.monthly"),type:"number",defaultValue:"0",classname:"w-48",...o("monthlyPlan",{required:"Monthly Plan is required"}),value:r.monthlyPlan,changeValue:e=>m("monthlyPlan",e.target.value),error:!!n.monthlyPlan,helperText:(G=n.monthlyPlan)==null?void 0:G.message}),s.jsx(te,{title:t("pos.company"),label:t("pos.companyName"),options:ce,classname:"w-80 sm:w-96",...o("organizationId",{required:"Organization ID is required"}),value:r.organizationId,onChange:e=>m("organizationId",e),error:!!n.organizationId,helperText:(J=n.organizationId)==null?void 0:J.message}),s.jsx(te,{title:t("pos.type"),label:t("pos.self"),options:[{name:"МСО",value:"SelfService"},{name:t("pos.robot"),value:"Portal"},{name:`МСО + ${t("pos.robot")}`,value:"SelfServiceAndPortal"}],classname:"w-80 sm:w-96",...o("carWashPosType",{required:"Pos Type is required"}),value:r.carWashPosType,onChange:e=>m("carWashPosType",e),error:!!n.carWashPosType,helperText:(K=n.carWashPosType)==null?void 0:K.message}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm text-text02",children:t("pos.min")}),s.jsx(u,{type:"number",classname:"w-48",...o("stepSumOrder",{required:"Step Sum Order is required"}),value:r.stepSumOrder,changeValue:e=>m("stepSumOrder",e.target.value),error:!!n.stepSumOrder,helperText:(Q=n.stepSumOrder)==null?void 0:Q.message})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm text-text02",children:t("pos.minAmount")}),s.jsx(u,{type:"number",classname:"w-48",...o("minSumOrder",{required:"Min Sum Order is required"}),value:r.minSumOrder,changeValue:e=>m("minSumOrder",e.target.value),error:!!n.minSumOrder,helperText:(X=n.minSumOrder)==null?void 0:X.message})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm text-text02",children:t("pos.maxAmount")}),s.jsx(u,{type:"number",classname:"w-48",...o("maxSumOrder",{required:"Max Sum Order is required"}),value:r.maxSumOrder,changeValue:e=>m("maxSumOrder",e.target.value),error:!!n.maxSumOrder,helperText:(Y=n.maxSumOrder)==null?void 0:Y.message})]}),s.jsxs("div",{children:[s.jsx("div",{children:t("pos.photos")}),s.jsx("div",{children:t("pos.maxNumber")}),s.jsx(z,{form:!1,iconPlus:!0,type:"outline",title:t("pos.download")})]})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-4 mt-6",children:[s.jsx(z,{title:t("organizations.cancel"),type:"outline",handleClick:()=>I()}),s.jsx(z,{title:t("organizations.save"),form:!0,handleClick:()=>{},isLoading:ge})]})]})]})]})};export{Ue as default};
