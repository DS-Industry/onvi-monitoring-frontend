import{R as U,U as W,V as k,W as G,X as H,Z as V,_ as X,Y,$ as Z,a0 as _,a1 as q,a2 as A,e as J,r as a,v as x,a3 as K,j as s,D as Q,a8 as j,G as w,H as F}from"./index-C24s9YLx.js";import{b as ee}from"./index-BzKdJFVM.js";import{S as te}from"./Saly-45-CS9u2NZ4.js";import{F as se}from"./FilterMonitoring-DnjDobpT.js";const ie=()=>{var P,I;const f=new Date().toISOString().slice(0,10),n=U(),C=W(),T=k(),u=G(),v=H(),y=V(),z=X(),g=Y(),c=Z(),b=_(),E=q(),L=A(),i=J();a.useEffect(()=>{var e;(e=i.state)!=null&&e.ownerId&&g(i.state.ownerId)},[(P=i.state)==null?void 0:P.ownerId,g]);const[N,h]=a.useState(!1),R={dateStart:C||`${f} 00:00`,dateEnd:T||`${f} 23:59`,page:u,size:v,deviceId:n},[r,p]=a.useState(R);a.useEffect(()=>{c(1),p(e=>({...e,page:1}))},[i,c]);const{data:t,error:B,isLoading:m,mutate:D}=x(n?["get-pos-program-pos-devices",n]:null,()=>ee(n||0,{dateStart:r.dateStart,dateEnd:r.dateEnd,page:r.page,size:r.size})),M=(t==null?void 0:t.totalCount)||0,o=Math.ceil(M/v);a.useEffect(()=>{u>o&&(c(o>0?o:1),p(e=>({...e,page:o>0?o:1})))},[o,u,c]);const{data:l}=x(["get-device-pos"],()=>K(L)),$=e=>{p(d=>({...d,...e})),h(!0),e.dateStart&&y(e.dateStart),e.dateEnd&&z(e.dateEnd),e.deviceId&&g(e.deviceId),e.page&&c(e.page),e.size&&b(e.size)};a.useEffect(()=>{},[B]),a.useEffect(()=>{D().then(()=>h(!1))},[r,D]),a.useEffect(()=>{!m&&(t!=null&&t.totalCount)&&E(t==null?void 0:t.totalCount)},[t==null?void 0:t.totalCount,m,E]);const S=((I=t==null?void 0:t.prog)==null?void 0:I.map(e=>e).sort((e,d)=>new Date(e.dateBegin).getTime()-new Date(d.dateBegin).getTime()))||[],O=((l==null?void 0:l.map(e=>e).sort((e,d)=>e.props.id-d.props.id))||[]).map(e=>({name:e.props.name,value:e.props.id}));return s.jsxs(s.Fragment,{children:[s.jsx(se,{count:S.length,devicesSelect:O,handleDataFilter:$,hideCity:!0,hideSearch:!0,hideReset:!0}),N||m?s.jsx(Q,{columnCount:j.length}):S.length>0?s.jsx("div",{className:"mt-8 overflow-hidden",children:s.jsx(w,{data:S,columns:j,showPagination:!0})}):s.jsx(s.Fragment,{children:s.jsx(F,{title:"В этом разделе представленны операции",description:"У вас пока нету операций",children:s.jsx(te,{className:"mx-auto"})})})]})};export{ie as default};
