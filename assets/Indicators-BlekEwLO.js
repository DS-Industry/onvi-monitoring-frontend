import{r as a,j as t,a2 as ne,c7 as g,U as le,V as ie,d as oe,q as re,v as C,w as de,aG as E,aH as h,aF as ce,aK as I,bz as P,aI as p,aM as T,aq as d,aA as ge,D as he,ae as V,G as pe}from"./index-C24s9YLx.js";import{N as ue}from"./Notification-KpAXhuNN.js";import{e as xe,C as me,a as fe,L as ve,P as we,f as Ce,p as De,c as je,d as ye}from"./index-aAWuU0TO.js";import{k as Se,l as be}from"./index-Dx68t6LI.js";import{e as Ee}from"./index-BzKdJFVM.js";import{G as Le,R as Fe}from"./BarChartOutlined-BasKC_kT.js";const Re=l=>a.createElement("svg",{width:60,height:60,viewBox:"0 0 60 60",fill:"none",xmlns:"http://www.w3.org/2000/svg",...l},a.createElement("rect",{width:60,height:60,rx:24,fill:"#DCDCF7"}),a.createElement("path",{d:"M25.9998 28.6667C23.0543 28.6667 20.6665 26.2789 20.6665 23.3333C20.6665 20.3878 23.0543 18 25.9998 18C28.9454 18 31.3332 20.3878 31.3332 23.3333C31.3332 26.2789 28.9454 28.6667 25.9998 28.6667Z",fill:"#8280FF"}),a.createElement("path",{d:"M37.9998 32.6667C35.7907 32.6667 33.9998 30.8758 33.9998 28.6667C33.9998 26.4575 35.7907 24.6667 37.9998 24.6667C40.209 24.6667 41.9998 26.4575 41.9998 28.6667C41.9998 30.8758 40.209 32.6667 37.9998 32.6667Z",fill:"#8280FF"}),a.createElement("path",{d:"M14.0009 40.9329C14.5177 34.5693 19.6826 31.334 25.9778 31.334C32.3616 31.334 37.6065 34.3916 37.9972 40.934C38.0128 41.1946 37.9972 42.0007 36.9956 42.0007H14.97C14.6356 42.0007 13.9727 41.2796 14.0009 40.9329Z",fill:"#8280FF"}),a.createElement("path",{d:"M40.1333 42.0007L45.2746 42.0007C45.998 42.0007 46.0092 41.3961 45.998 41.2007C45.7189 36.3475 42.0103 34.0511 37.4683 34.0015C39.1417 36.2298 40.1333 38.9994 40.1333 42.0007Z",fill:"#8280FF"})),ke=l=>a.createElement("svg",{width:60,height:60,viewBox:"0 0 60 60",fill:"none",xmlns:"http://www.w3.org/2000/svg",...l},a.createElement("rect",{width:60,height:60,rx:24,fill:"#D9F7E8"}),a.createElement("g",{opacity:.5},a.createElement("path",{d:"M42.4444 40.8889H19.1111V17.5556C19.1111 16.6964 18.4147 16 17.5556 16C16.6964 16 16 16.6964 16 17.5556V42.4444C16 43.3036 16.6964 44 17.5556 44H42.4444C43.3036 44 44 43.3036 44 42.4444C44 41.5853 43.3036 40.8889 42.4444 40.8889Z",fill:"#00A355"}),a.createElement("path",{d:"M22.7138 34.2469C23.3406 34.8345 24.325 34.8027 24.9126 34.176L29.7306 29.0367L34.4347 33.0509C35.1059 33.6237 36.1186 33.524 36.6653 32.8315L43.6653 23.9648C44.1977 23.2905 44.0826 22.3123 43.4083 21.78C42.734 21.2477 41.7558 21.3627 41.2235 22.037L35.2248 29.6353L30.6208 25.7065C29.9888 25.1672 29.0445 25.2198 28.4762 25.8259L22.6429 32.0481C22.0553 32.6749 22.0871 33.6593 22.7138 34.2469Z",fill:"#00A355"}))),Ne=l=>a.createElement("svg",{width:60,height:60,viewBox:"0 0 60 60",fill:"none",xmlns:"http://www.w3.org/2000/svg",...l},a.createElement("rect",{width:60,height:60,rx:24,fill:"#FFDED1"}),a.createElement("g",{opacity:.901274},a.createElement("path",{d:"M21.8524 15.3843C21.9477 14.9846 22.4577 14.8642 22.7218 15.1789L24.5197 17.3217C26.2029 16.605 28.0551 16.2084 30 16.2084C37.732 16.2084 44 22.4764 44 30.2084C44 37.9404 37.732 44.2084 30 44.2084C22.268 44.2084 16 37.9404 16 30.2084C16 28.8952 16.1808 27.6243 16.5188 26.4191L19.0864 27.1393C18.809 28.1285 18.6667 29.1576 18.6667 30.2084C18.6667 36.4676 23.7408 41.5417 30 41.5417C36.2592 41.5417 41.3333 36.4676 41.3333 30.2084C41.3333 23.9492 36.2592 18.8751 30 18.8751C28.7317 18.8751 27.4965 19.083 26.3316 19.481L28.133 21.6278C28.3976 21.9431 28.1892 22.4252 27.7783 22.4484L20.7336 22.8477C20.3993 22.8666 20.1412 22.5581 20.2189 22.2324L21.8524 15.3843Z",fill:"#FF9066"}),a.createElement("path",{d:"M29.1294 23.541C28.8682 23.541 28.651 23.7422 28.6309 24.0027L28.0315 31.7957C28.0131 32.0348 28.167 32.2533 28.3984 32.3164L34.7015 34.0354C35.0196 34.1222 35.3331 33.8827 35.3331 33.5531V33.1645C35.3331 32.9851 35.237 32.8194 35.0812 32.7304L30.6664 30.2077L30.0448 23.9913C30.0192 23.7357 29.8041 23.541 29.5473 23.541H29.1294Z",fill:"#FF9066"})));me.register(fe,ve,we,Ce,De,je,ye);const Me=({revenueData:l})=>{const u={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}}},D={labels:l.map(c=>new Date(c.date).toLocaleDateString()),datasets:[{fill:!0,label:"Revenue",data:l.map(c=>c.sum),borderColor:"#0B68E1",backgroundColor:"#9BD0F5",tension:.4}]};return t.jsx(xe,{data:D,options:u})},{Text:Pe,Title:Te}=I,He=()=>{var M;const l=ne(),{RangePicker:u}=g,{useBreakpoint:D}=Le,c=D(),[B,Z]=a.useState(!0),[j,A]=a.useState(l),L=le(),F=ie(),[o,x]=a.useState({dateStart:L,dateEnd:F}),[r,m]=a.useState({dateStart:L,dateEnd:F}),{t:i}=oe(),G=i("warehouse.all"),y=re(),[H,f]=a.useState(null),[O,v]=a.useState(null),R=[{label:i("dashboard.today"),value:"today"},{label:i("dashboard.week"),value:"week"},{label:i("dashboard.month"),value:"month"}],{data:z,isLoading:U}=C(["get-statistic"],()=>Se()),{data:S,isLoading:_,isValidating:q}=C(["get-pos-deposits",o,j],()=>Ee({...o,posId:j,placementId:y})),{data:K,isLoading:W,isValidating:Y}=C(["get-graph",r],()=>be({...r})),k=K||[],{data:b}=C(["get-pos",y],()=>de({placementId:y}),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),$=((M=S==null?void 0:S.oper)==null?void 0:M.map(e=>e).sort((e,s)=>e.id-s.id))||[],w=z||{cars:0,sum:0},N=(b==null?void 0:b.map(e=>({name:e.name,value:e.id})))||[],J={name:G,value:"*"};N.unshift(J);const Q=e=>e==null||isNaN(e)?"-":new Intl.NumberFormat("ru-RU",{minimumFractionDigits:0,maximumFractionDigits:0,useGrouping:!0}).format(e),X=[{title:"visitors",number:w?w.cars:0,unit:"",icon:Re,isPositive:!0,percentage:"12",day:"К предыдущему дню"},{title:"profit",number:w?Q(w.sum):0,unit:"₽",icon:ke,isPositive:!0,percentage:"15",day:"К предыдущему дню"},{title:"downtime",number:7,unit:"мин",icon:Ne,isPositive:!0,percentage:"15",day:"К предыдущему дню"}],ee=e=>{const s=new Date;let n=s;e==="today"?n=new Date(s.toISOString().slice(0,10)):e==="week"?(n=new Date,n.setDate(s.getDate()-7)):e==="month"&&(n=new Date,n.setMonth(s.getMonth()-1)),x({dateStart:n,dateEnd:s}),f(e)},te=e=>{const s=new Date;let n=s;e==="today"?n=new Date(s.toISOString().slice(0,10)):e==="week"?(n=new Date,n.setDate(s.getDate()-7)):e==="month"&&(n=new Date,n.setMonth(s.getMonth()-1)),m({dateStart:n,dateEnd:s}),v(e)},ae=e=>{if(e){const[s,n]=e;x({dateStart:(s==null?void 0:s.toDate())||new Date,dateEnd:(n==null?void 0:n.toDate())||new Date}),f(null)}},se=e=>{if(e){const[s,n]=e;m({dateStart:(s==null?void 0:s.toDate())||new Date,dateEnd:(n==null?void 0:n.toDate())||new Date}),v(null)}};return t.jsxs(t.Fragment,{children:[B&&t.jsx(ue,{title:i("indicators.notification"),message:i("indicators.notificationText"),onClose:()=>Z(!1),link:"",linkUrl:""}),t.jsxs("div",{className:"grid gap-4",children:[t.jsx(E,{gutter:[24,24],children:X.map(e=>t.jsx(h,{xs:24,md:12,lg:8,children:t.jsx(ce,{variant:"borderless",styles:{body:{padding:24,borderRadius:24,backgroundColor:"#fff",boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.06)"}},children:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[t.jsxs("div",{children:[t.jsx(Pe,{strong:!0,style:{fontSize:18},children:i(`indicators.${e.title}`)}),t.jsx(Te,{level:2,style:{margin:0,color:"#202224"},children:U?t.jsx(P.Button,{active:!0,size:"default",shape:"default",block:!1}):t.jsxs(t.Fragment,{children:[e.number," ",e.unit]})})]}),t.jsx(e.icon,{})]})})},e.title))}),t.jsxs("div",{className:"mt-4 py-3 lg:py-8 grid gap-8 bg-white shadow-card rounded-lg",children:[t.jsx("p",{className:"text-background01 font-semibold text-2xl px-3 lg:px-8",children:i("indicators.revenue")}),t.jsxs(E,{justify:"space-between",align:"middle",wrap:!0,gutter:[16,16],style:{marginBottom:"4px",padding:"20px"},children:[t.jsx(h,{xs:24,lg:16,children:t.jsx(p,{wrap:!0,children:R.map(e=>t.jsx(T,{type:O===e.value?"primary":"default",shape:"round",onClick:()=>te(e.value),children:e.label},e.value))})}),t.jsx(h,{xs:24,lg:8,children:c.xs?t.jsxs(p,{direction:"vertical",style:{width:"100%"},children:[t.jsx(g,{placeholder:"Start date",value:d(r.dateStart),onChange:e=>{e&&(m({...r,dateStart:e.toDate()}),v(null))},style:{width:"100%"}}),t.jsx(g,{placeholder:"End date",value:d(r.dateEnd),onChange:e=>{e&&(m({...r,dateEnd:e.toDate()}),v(null))},style:{width:"100%"}})]}):t.jsx(u,{onChange:se,value:[d(r.dateStart),d(r.dateEnd)],allowClear:!1,style:{width:"100%"}})})]}),t.jsx("div",{className:"w-full h-64 lg:h-96 overflow-auto px-3 lg:px-8",children:W||Y?t.jsx("div",{className:"h-full flex flex-col w-full",children:t.jsx(P.Image,{style:{width:"100%",height:"380px"},active:!0})}):k.length===0?t.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"300px"},children:t.jsxs(p,{direction:"vertical",align:"center",children:[t.jsx(Fe,{style:{fontSize:"48px",opacity:.5}}),t.jsx(I.Text,{type:"secondary",children:"No data available"})]})}):t.jsx(Me,{revenueData:k})})]}),t.jsxs("div",{className:"mt-4 py-3 lg:py-8 grid gap-8 bg-white shadow-card rounded-lg",children:[t.jsx("p",{className:"text-background01 font-semibold text-2xl px-3 lg:px-8",children:i("indicators.revReport")}),t.jsxs(E,{justify:"space-between",align:"middle",wrap:!0,gutter:[16,16],style:{marginBottom:"4px",padding:"20px"},children:[t.jsx(h,{xs:24,lg:16,children:t.jsxs(p,{wrap:!0,children:[t.jsx("div",{children:t.jsx(ge,{className:"w-80",placeholder:"Выберите объект",options:N.map(e=>({label:e.name,value:e.value})),value:j,onChange:A,dropdownRender:e=>t.jsx("div",{style:{maxHeight:100,overflowY:"auto"},children:e})})}),R.map(e=>t.jsx(T,{type:H===e.value?"primary":"default",shape:"round",onClick:()=>ee(e.value),children:e.label},e.value))]})}),t.jsx(h,{xs:24,lg:8,children:c.xs?t.jsxs(p,{direction:"vertical",style:{width:"100%"},children:[t.jsx(g,{placeholder:"Start date",value:d(o.dateStart),onChange:e=>{e&&(x({...o,dateStart:e.toDate()}),f(null))},style:{width:"100%"}}),t.jsx(g,{placeholder:"End date",value:d(o.dateEnd),onChange:e=>{e&&(x({...o,dateEnd:e.toDate()}),f(null))},style:{width:"100%"}})]}):t.jsx(u,{onChange:ae,value:[d(o.dateStart),d(o.dateEnd)],allowClear:!1,style:{width:"100%"}})})]}),t.jsx("div",{className:"overflow-x-auto px-5",children:_||q?t.jsx(he,{columnCount:V.length}):t.jsx(pe,{data:$,columns:V,isDisplayEdit:!0,navigableFields:[{key:"name",getPath:()=>"/station/enrollments/devices"}]})})]})]})]})};export{He as default};
