import{d as me,r as i,b as ce,l as ue,v as b,ah as pe,q as xe,z as P,j as a,y as he,A as ge,L as l,D as je,cB as A,G as fe,H as ve,aB as U,aC as Y,B as h,K as c,aP as ye,aq as we,M as be}from"./index-C24s9YLx.js";import{N as Ie}from"./Notification-KpAXhuNN.js";import{N as Ne}from"./NoOverhead-DLWLoKhg.js";import{e as ke,g as ze,u as Se,f as Ce}from"./index-Dx68t6LI.js";const Te=()=>{var D,T,$,M,L,E,F;const{t:s}=me(),[I,H]=i.useState(""),[N,g]=i.useState(!1),[G,u]=i.useState(!1),[k,z]=i.useState(0),[K,J]=i.useState(0),{buttonOn:S,setButtonOn:C}=ce(),{showSnackbar:Q}=ue(),{data:j,isLoading:X}=b(["get-worker"],()=>pe(),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),{data:f}=b(["get-role"],()=>ke(),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),Z=xe(),{data:v}=b(["get-org"],()=>ze({placementId:Z})),_=(v==null?void 0:v.map(e=>({name:e.name,value:e.id})))||[],{trigger:ee,isMutating:ae}=P(["update-role"],async()=>Se({userId:K,roleId:k})),y=(f==null?void 0:f.map(e=>({name:e.name,value:e.id,render:a.jsxs("div",{children:[a.jsx("div",{children:e.name}),a.jsx("div",{className:"text-text02",children:"Lorem ipsum dolor, sit amet consectetur"})]})})))||[];i.useEffect(()=>{S&&u(!0)},[S]);const q={name:"",surname:"",middlename:"",birthday:"",phone:"",email:"",organizationId:0,roleId:0,position:""},[t,O]=i.useState(q),{register:r,handleSubmit:se,errors:n,setValue:te,reset:ne}=he(t),{trigger:re,isMutating:oe}=P(["add-role"],async()=>Ce({name:t.name,middlename:t.middlename,surname:t.surname,birthday:new Date(`${t.birthday}T13:24:45.742+03:00`),phone:t.phone,email:t.email,organizationId:t.organizationId,roleId:t.roleId,position:t.position})),o=(e,d)=>{const w=["organizationId","categoryId","supplierId"].includes(e)?Number(d):d;O(x=>({...x,[e]:w})),te(e,d)},R=()=>{O(q),ne(),u(!1),C(!1)},ie=async()=>{try{await re()&&(Q(s("organizations.token"),"success"),R())}catch(e){console.error("Register error:",e)}},p=(j==null?void 0:j.map(e=>({id:e.id,name:`${e.surname} ${e.name} ${e.middlename}`,position:e.position,roleName:e.roleName,status:s(`tables.${e.status}`),createdAt:e.createAt?new Date(e.createAt).toLocaleDateString("ru-RU"):"N/A"})))||[],le=e=>{var x,B,W;const d=((x=p.find(m=>m.id===e))==null?void 0:x.name)||"",V=((B=p.find(m=>m.id===e))==null?void 0:B.roleName)||"",w=((W=y.find(m=>m.name===V))==null?void 0:W.value)||0;J(e),z(w),H(d),g(!0)},de=async()=>{await ee()&&be(["get-worker"])};return a.jsxs("div",{children:[a.jsxs(ge,{count:0,hideCity:!0,hideDateTime:!0,hideSearch:!0,children:[a.jsx(l,{title:s("roles.job"),value:void 0,options:[],classname:"ml-2"}),a.jsx(l,{title:s("finance.status"),value:void 0,options:[],classname:"ml-2"})]}),a.jsxs("div",{className:"mt-5",children:[a.jsx(Ie,{title:s("roles.access"),message:s("roles.change"),message2:s("roles.then"),showEmp:!0}),X?a.jsx(je,{columnCount:A.length}):p.length>0?a.jsx(fe,{data:p,columns:A,onEdit:le}):a.jsx(ve,{title:s("organizations.noLegal"),description:s("organizations.addLegal"),children:a.jsx("img",{src:Ne,className:"mx-auto",loading:"lazy",alt:"List"})}),N&&I&&a.jsxs(U,{isOpen:N,classname:"sm:w-[552px] sm:h-[300px]",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{}),a.jsx(Y,{onClick:()=>g(!1),className:"cursor-pointer text-text01"})]}),a.jsx("h2",{className:"text-2xl font-semibold text-text01 mb-4",children:s("roles.role")}),a.jsx("p",{className:"text-primary02 text-sm",children:I}),a.jsx(l,{value:k,options:y,onChange:e=>z(e),classname:"w-[300px] sm:w-[456px]",renderOption:e=>e.render||a.jsx("span",{children:e.name})}),a.jsxs("div",{className:"flex justify-end space-x-4 mt-10",children:[a.jsx(h,{title:s("organizations.cancel"),type:"outline",handleClick:()=>g(!1)}),a.jsx(h,{title:s("organizations.save"),isLoading:ae,handleClick:de})]})]}),a.jsxs(U,{isOpen:G,classname:"sm:w-[552px]",children:[a.jsxs("div",{className:"flex flex-row items-center justify-between mb-4",children:[a.jsx("h2",{className:"text-lg font-semibold text-text01",children:s("roles.create")}),a.jsx(Y,{onClick:()=>{u(!1),C(!1)},className:"cursor-pointer text-text01"})]}),a.jsxs("form",{className:"space-y-4",onSubmit:se(ie),children:[a.jsxs("div",{className:"mb-5 flex",children:[a.jsx("span",{className:"font-semibold text-sm text-text01",children:s("routine.fields")}),a.jsx("span",{className:"text-errorFill",children:"*"}),a.jsx("span",{className:"font-semibold text-sm text-text01",children:s("routine.are")})]}),a.jsx(c,{type:"text",title:s("roles.name"),classname:"w-80 sm:w-96",value:t.name,changeValue:e=>o("name",e.target.value),error:!!n.name,...r("name",{required:"Name is required"}),helperText:((D=n.name)==null?void 0:D.message)||""}),a.jsx(c,{type:"text",title:s("profile.surname"),classname:"w-80 sm:w-96",value:t.surname,changeValue:e=>o("surname",e.target.value),...r("surname")}),a.jsx(c,{type:"text",title:s("profile.middlename"),classname:"w-80 sm:w-96",value:t.middlename,changeValue:e=>o("middlename",e.target.value),...r("middlename")}),a.jsx(ye,{title:`${s("register.date")}*`,classname:"w-40",value:t.birthday?we(t.birthday):null,changeValue:e=>o("birthday",e?e.format("YYYY-MM-DD"):""),error:!!n.birthday,...r("birthday",{required:"Birthday is required"}),helperText:((T=n.birthday)==null?void 0:T.message)||""}),a.jsx(c,{type:"text",title:`${s("register.phone")}*`,classname:"w-80 sm:w-96",value:t.phone,changeValue:e=>o("phone",e.target.value),error:!!n.phone,...r("phone",{required:"Phone is required",pattern:{value:/^\+79\d{9}$/,message:"Phone number must start with +79 and be 11 digits long"}}),helperText:(($=n.phone)==null?void 0:$.message)||""}),a.jsx(c,{type:"text",title:"Email*",classname:"w-80 sm:w-96",value:t.email,changeValue:e=>o("email",e.target.value),error:!!n.email,...r("email",{required:"Email is required",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Invalid email format"}}),helperText:((M=n.email)==null?void 0:M.message)||""}),a.jsx(l,{title:`${s("warehouse.organization")}*`,label:s("warehouse.notSel"),options:_,classname:"w-80 sm:w-96",...r("organizationId",{required:"Organization Id is required",validate:e=>e!==0||"Category ID is required"}),value:t.organizationId,onChange:e=>o("organizationId",e),error:!!n.organizationId,helperText:(L=n.organizationId)==null?void 0:L.message}),a.jsx(l,{title:`${s("roles.rol")}*`,label:s("warehouse.notSel"),options:y,classname:"w-80 sm:w-96",...r("roleId",{required:"Role Id is required",validate:e=>e!==0||"Category ID is required"}),value:t.roleId,onChange:e=>o("roleId",e),error:!!n.roleId,helperText:(E=n.roleId)==null?void 0:E.message}),a.jsx(l,{title:`${s("roles.position")}*`,options:[{name:"Оператор",value:"Operator"}],classname:"w-80 sm:w-96",error:!!n.position,...r("position",{required:"Position is required"}),value:t.position,onChange:e=>o("position",e),helperText:((F=n.position)==null?void 0:F.message)||""}),a.jsxs("div",{className:"flex space-x-4",children:[a.jsx(h,{title:s("organizations.cancel"),type:"outline",handleClick:()=>{R(),u(!1)}}),a.jsx(h,{title:s("roles.create"),form:!0,isLoading:oe,handleClick:()=>{}})]})]})]})]})]})};export{Te as default};
