import{d as j,a2 as I,r as u,q as S,v as m,w,cz as B,z as F,cA as O,j as t,bL as C,D as M,B as P}from"./index-C24s9YLx.js";import{O as R}from"./OverflowTable-BMnnkjZz.js";const N=()=>{const{t:p}=j(),y=I(),[a,b]=u.useState(y),[v,T]=u.useState({}),r=S(),{data:n}=m(["get-pos",r],()=>w({placementId:r}),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),x=(n==null?void 0:n.map(e=>({name:e.name,value:e.id})))||[],c=[{label:"Устройство",key:"deviceName"},{label:"Инкассация",key:"Begin",render:e=>t.jsx("div",{className:"flex justify-start",children:t.jsx(P,{title:"Проинкассировал",classname:"border border-successFill rounded px-2 py-2 text-successFill hover:border-successFill/80 hover:text-successFill/80",type:"outline",handleClick:()=>{g(e.deviceId)},disabled:v[e.deviceId]})})},{label:"Дата предыдущей инкасации",key:"oldTookMoneyTime",type:"date"},{label:"Дата текущей Инкасции",key:"tookMoneyTime",type:"date"}],{data:l,isLoading:f,mutate:h}=m(a!=="*"&&a?["get-timestamp",a]:null,()=>B(a),{revalidateOnFocus:!1,revalidateOnReconnect:!1,keepPreviousData:!0}),{trigger:k}=F(["post-timestamp"],async(e,{arg:s})=>O(s.body,s.id)),g=async e=>{try{const d=await k({body:{dateTimeStamp:new Date},id:e});d&&T(o=>({...o,[e]:!0})),h(o=>o&&o.map(i=>i.deviceId===e?{...i,tookMoneyTime:d.tookMoneyTime}:i),!1)}catch(s){console.error("Error in postTimestamp:",s)}};return t.jsxs("div",{children:[t.jsx(C,{title:p("finance.carWash"),options:x,classname:"w-64",value:a,onChange:e=>b(e),allowClear:!0}),t.jsx("div",{className:"mt-8",children:f?t.jsx(M,{columnCount:c.length}):t.jsx(R,{tableData:l==null?void 0:l.sort((e,s)=>e.deviceId-s.deviceId),columns:c})})]})};export{N as default};
