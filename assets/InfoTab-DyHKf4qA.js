import{d as S,r as m,j as e,L as D,g as R,a9 as M,aa as $,eO as z,eP as B,eQ as H,y as J,z as K,K as d,B as b,u as O}from"./index-C24s9YLx.js";import{u as Q}from"./index-Bs2AcXlY.js";import{A as W}from"./Avatar-Bdpt2qJs.js";const G=[{value:"en",name:"English"},{value:"ru",name:"Russian"}],X=()=>{const{i18n:s}=S(),p=localStorage.getItem("language")?localStorage.getItem("language"):"ru",[h,g]=m.useState(p),o=l=>{s.changeLanguage(l),g(l),localStorage.setItem("language",l)};return e.jsx("div",{children:e.jsx(D,{value:h,options:G,onChange:o,classname:"w-80"})})},ee=()=>{var v,j,w;const{t:s}=S(),[p,h]=m.useState(null),[g,o]=m.useState(null),l=R(),P=M(),y=$(),N=z(),U=B(),C=H(),I={name:l.name,middlename:l.middlename},f=m.useMemo(()=>({name:l.name||"",email:l.email||"",phone:l.phone||"",middlename:l.middlename||"",surname:l.surname||"",imagePreview:l.avatar?"https://storage.yandexcloud.net/onvi-business/avatar/user/"+l.avatar:null}),[l]),[t,F]=m.useState(f),{register:u,handleSubmit:E,errors:i,setValue:L}=J(t),{trigger:T,isMutating:V}=K("user",async()=>Q({name:t.name,email:t.email,phone:t.phone,middlename:t.middlename,surname:t.surname},p));m.useEffect(()=>{const a=localStorage.getItem("avatarUrl")||f.imagePreview;a&&o(a)},[f.imagePreview]);const q=a=>{var n;const r=((n=a.target.files)==null?void 0:n[0])||null;if(h(r),r){const x=new FileReader;x.onloadend=()=>{o(x.result)},x.readAsDataURL(r)}else o(null)},c=(a,r)=>{F(n=>({...n,[a]:r})),L(a,r)},k=async()=>{try{const a=T();if((await a).props.avatar){const n=`https://storage.yandexcloud.net/onvi-business/avatar/user/${(await a).props.avatar}`||null;o(n),localStorage.setItem("avatarUrl",n||"")}const[r]=await Promise.all([a]);if(r)P({user:r==null?void 0:r.props});else throw new Error("Failed to update user profile")}catch(a){console.error("Error updating profile:",a)}},A=()=>{localStorage.clear(),sessionStorage.clear(),y(),N(),U(),C([]),O.getState().reset(),window.location.href=""};return e.jsx("div",{className:"max-w-6xl mr-auto",children:e.jsxs("form",{onSubmit:E(k),className:"flex flex-col md:flex-row justify-between items-start gap-6",children:[e.jsxs("div",{className:"flex flex-col space-y-6 w-full",children:[e.jsx(d,{title:s("profile.name"),label:s("profile.namePlaceholder"),value:t.name,changeValue:a=>{c("name",a.target.value)},...u("name",{required:"Имя is required"}),classname:"w-80",error:!!i.name,helperText:(v=i.name)==null?void 0:v.message}),e.jsx(d,{title:s("profile.middlename"),label:s("profile.middlenamePlaceholder"),value:t.middlename,changeValue:a=>{c("middlename",a.target.value)},...u("middlename"),classname:"w-80"}),e.jsx(d,{title:s("profile.surname"),label:s("profile.surnamePlaceholder"),value:t.surname,changeValue:a=>{c("surname",a.target.value)},...u("surname"),classname:"w-80"}),e.jsx(d,{type:"text",title:s("profile.telephone"),label:s("profile.telephonePlaceholder"),classname:"mb-5",value:t.phone,changeValue:a=>c("phone",a.target.value),error:!!i.phone,...u("phone",{required:"phone is required",pattern:{value:/^\+79\d{9}$/,message:"Phone number must start with +79 and be 11 digits long"}}),helperText:((j=i.phone)==null?void 0:j.message)||""}),e.jsx(d,{type:"text",title:"E-mail *",classname:"mb-5",value:t.email,changeValue:a=>c("email",a.target.value),error:!!i.email,...u("email",{required:"email is required",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Invalid email format"}}),helperText:((w=i.email)==null?void 0:w.message)||"",disabled:!0}),e.jsxs("div",{className:"flex",children:[e.jsx("input",{type:"checkbox"}),e.jsx("div",{className:"ml-2 text-text02 text-base",children:s("profile.agree")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-text02",children:s("routes.lan")}),e.jsx(X,{})]}),e.jsx("div",{className:"flex",children:e.jsx(b,{form:!1,title:s("profile.logout"),classname:"mt-2",handleClick:A})})]}),e.jsxs("div",{className:"flex flex-col items-center md:ml-auto lg:ml-40 w-full md:w-1/3",children:[e.jsx("div",{children:s("profile.photo")}),g?e.jsx("div",{className:"relative w-36 h-36 rounded-full bg-[#bffa00] flex items-center justify-center",children:e.jsx("img",{src:g,alt:"Profile",className:"rounded-full w-full h-full object-cover",loading:"lazy"})}):e.jsx(W,{type:"profile",userName:I}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{htmlFor:"file-upload",className:"w-36 flex justify-center items-center text-primary02 cursor-pointer",children:s("profile.changePh")}),e.jsx("input",{id:"file-upload",type:"file",accept:"image/*",className:"hidden",onChange:q})]}),e.jsx("div",{className:"flex",children:e.jsx(b,{form:!0,title:s("profile.save"),classname:"mt-10",isLoading:V})})]})]})})};export{ee as default};
